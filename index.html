<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="stylesheet" href="mobile.css">
<link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1b5e20">
<title>Monopoly Card Drawer</title>

<style>


/* =========================================
   GLOBAL COLORS
========================================= */



:root {
    --restaurant-color: #FFAC1C;
    --garden-color: #2E7D32;
    --mall-color: #1565C0;
    --casino-color: #6A1B9A;
    --farm-color: #558B2F;
    --radio-color: #c56cf0;

    --chance-color: #f08080;
    --community-color: #00bfff;

    --brown-color: #8B4513;
    --lightblue-color: #00bfff;
    --pink-color: #FF69B4;
    --orange-color: #FFA500;
    --red-color: #FF0000;
    --yellow-color: #FFD700;
    --green-color: #228B22;
    --purple-color: #6A0DAD;

    --transport-color: #000;
    --state-color: #777;

    --tint-strength: 30%;

  --bg:#0b1020;
  --panel:#121933;
  --banner:#2196f3;
  --text:#e9eeff;
  --pointer:#ffd166;

--scene-dark: #0b1020;

}




/* =========================================
   BACKGROUND
========================================= */
body {
    font-family: "Trebuchet MS", Arial, sans-serif;
    background: linear-gradient(135deg, #29a6dd, #74d8b3, #f7f09b);
    background-size: 400% 400%;
    animation: bgMove 18s ease infinite;
    margin: 0;
    padding: 20px;
    height: 100vh;
    overflow: hidden;
}

@keyframes bgMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}


/* =========================================
   MAIN LAYOUT (Left | Center | Right)
========================================= */
.layout {
    display: grid;
    grid-template-columns: 35vh 50% 35vh;
    gap: 40px;
    height: calc(100vh - 70px);
    overflow: hidden;
    align-items: start;
}

/* LEFT PANEL */
.left-panel {
    display: flex;
    flex-direction: column;
    gap: 3vh;
margin-top: 5vh;
}

/* CENTER PANEL */
.center-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4vh;
}

/* RIGHT PANEL */
.far-right-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 16vh;
right: -2vh;
}

/* =========================================
   WELCOME CARD
========================================= */
#welcomeCard {
    width: 100%;
    
    height: 60vh;
    background: white;
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    justify-content: center;
overflow: hidden;  
}

#welcomeTitle {
    font-size: clamp(3vh, 4vh, 5vh);
    text-align: center;
    margin: 5px 0 15px;
    color: #fff;
    text-shadow: 0 0 10px #ff0080, 0 0 20px #ff0080;
}

#welcomeTitle .subtitle {
    font-size: clamp(2vh, 3vh, 4vh);
    text-align: center;
    margin: 5px 0 15px;
    color: #fff;
    text-shadow: 0 0 10px #ff0080, 0 0 20px #ff0080;
}

#welcomeIcons {
    font-size: clamp(4vh, 5vh, 8vh);
}

#welcomeText {
    font-size: clamp(2vh, 3vh, 4vh);
    color: #444;
}

/* =========================================
   BUTTONS + ANIMATIONS
========================================= */
.draw-btn, .big-btn {
    border: none;
    border-radius: 18px;
    cursor: pointer;
    color: white;
    font-weight: bold;
    transition: 0.2s ease;
    box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
height: 13vh;
    font-size: 3.5vh;
width: 30vh;
}



.draw-btn:hover,
.big-btn:hover {
    transform: translateY(-3px) scale(1.03);
}

.icon {
    font-size: 4vh; /* All icon size */
}

/* Button colors */
.restaurant-btn { background: var(--restaurant-color); color:#4b2c00; }
.park-btn { background: var(--garden-color); }
.mall-btn { background: var(--mall-color); }
.farm-btn { background: var(--farm-color); }

.casino-btn     { background: var(--casino-color); }
.radio-btn      { background: var(--radio-color); }


/* Chance/Community bottom buttons */
.bottom-buttons {
    display: flex;
    gap: 3vh;
}

.big-btn {
    width: 45vh;     /* chance and community buttons */
}


.far-right-panel .draw-btn {
    height: 13vh;   /* Radio buttons */
width: 30vh;
margin: 12vh;
}




.big-chance { background: var(--chance-color); }
.big-community { background: var(--community-color); }

/* =========================================
   POPUPS (with animation)
========================================= */
.modal-overlay {
gap: 2vh !important;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal {
    width: 98vh;
height:32vh;

    max-height: 45vh;
    overflow-y: auto;
    background: white;
    border-radius: 20px;
    padding: 20px;
    animation: pop 0.2s ease-out;
    position: relative;
}

@keyframes pop {
    from { transform: scale(0.6); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
}

.close-btn {
    position: absolute;
    right: 12px;
    top: 10px;
    font-size: 4vh;
    cursor: pointer;
}

/* =========================================
   SOUND BUTTON
========================================= */
.sound-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 4vh;
    background: black;
    border: 2px solid white;
    width: 7.5vh;
    height: 6.5vh;
    border-radius: 50%;
    cursor: pointer;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 10px rgba(0,0,0,0.6);

}

.sound-btn:hover {
    transform: scale(1.1);
}



#soundToggle {
    right: 1.5vh; /* sound button position */
}







/* =========================================
   RESPONSIVE
========================================= */
@media (max-width: 1100px) {
    .layout {
        grid-template-columns: 1fr;
        height: auto;
    }

    .draw-btn {
        width: 45%;
    }

    .bottom-buttons {
        flex-wrap: wrap;
    }

    .far-right-panel {
        padding-top: 10px;
    }
}









.modal.tinted {
    background: linear-gradient(
        -135deg,
        color-mix(in srgb, var(--tint) var(--tint-strength), white) 0%,
        white 100%
    );
}


.popup-chance     { border-left: 18px solid var(--chance-color);     --tint: var(--chance-color); }
.popup-community  { border-left: 18px solid var(--community-color);  --tint: var(--community-color); }
.popup-restaurant { border-left: 18px solid var(--restaurant-color); --tint: var(--restaurant-color); }
.popup-pier       { border-left: 18px solid var(--pier-color);       --tint: var(--pier-color); }
.popup-garden     { border-left: 18px solid var(--garden-color);     --tint: var(--garden-color); }
.popup-casino     { border-left: 18px solid var(--casino-color);     --tint: var(--casino-color); }
.popup-radio      { border-left: 18px solid var(--radio-color);      --tint: var(--radio-color); }


.radio-border-brown      { border-left: 18px solid var(--brown-color);      --tint: var(--brown-color); }
.radio-border-lightblue  { border-left: 18px solid var(--lightblue-color);  --tint: var(--lightblue-color); }
.radio-border-pink       { border-left: 18px solid var(--pink-color);       --tint: var(--pink-color); }
.radio-border-orange     { border-left: 18px solid var(--orange-color);     --tint: var(--orange-color); }
.radio-border-red        { border-left: 18px solid var(--red-color);        --tint: var(--red-color); }
.radio-border-yellow     { border-left: 18px solid var(--yellow-color);     --tint: var(--yellow-color); }
.radio-border-green      { border-left: 18px solid var(--green-color);      --tint: var(--green-color); }
.radio-border-purple     { border-left: 18px solid var(--purple-color);     --tint: var(--purple-color); }

.radio-border-transport  { border-left: 18px solid #000;                     --tint: #000; }
.radio-border-state      { border-left: 18px solid #777;                     --tint: #777; }







.layout,
.center-panel,
.far-right-panel {
    overflow: visible !important;
}

.far-right-panel {
    position: relative;
}




/* GLOBAL POPUP FONTS (ALL CARDS) */
.modal h2 {font-size: clamp(4vh, 5vh, 6vh);}
.modal p {font-size: clamp(3vh, 4vh, 5vh);}
.modal.popup-radio-dice {height: 30vh; margin: 2px;}
.modal.popup-radio-dice h2 {font-size: clamp(4vh, 5vh, 6vh)}
.modal.popup-radio-dice p {font-size: clamp(2.2vh, 2.35vh, 2.5vh);line-height: 1.3 }


.modal.popup-radio-dice h2 {
    margin-top: 0 !important; 
margin-bottom: 0 !important;        /* removes default h2 margin */
    padding-top: 0 !important;       /* ensures no padding either */
}







/* RADIO PROPERTY POPUP ‚Äî set height to 20vh */
.modal[class*="radio-border-"] {
    height: 16vh !important;
margin-top: 0 !important;
    margin-bottom: 0 !important;

}














/* =========================================
   FLOATING WELCOME CARD ANIMATION
========================================= */
@keyframes welcomeFloat {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}

.floating-welcome {
  animation: welcomeFloat 3s ease-in-out infinite;
}











/* =========================================
   MINI 3D DICE FOR WELCOME PANEL
========================================= */

#welcomeCard .dice-wrap {
    display: flex;
    justify-content: center;
    gap: 4.5vh;
    margin: 3vh;
margin-top: 4vh;
    position: relative;
    z-index: -1;
}

#welcomeCard .dice-scene {
    width: 8vh;
    height: 8vh;

}

#welcomeCard .cube {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
}

#welcomeCard .cube .face {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 10px;
    background: #f9fafb;
    display: grid;
    place-items: center;
    box-shadow: inset 0 0 12px rgba(0, 0, 0, .12);
}

#welcomeCard .pip {
    width: 23%;
    height: 23%;
    background: #000;
    border-radius: 50%;
}

#welcomeCard .pips {
    position: relative;
    width: 60%;
    height: 60%;
}

#welcomeCard .pips .pip {
    position: absolute;
    transform: translate(-50%, -50%);
}

/* pip layouts */
#welcomeCard .pips1 .pip:nth-child(1) { top: 50%; left: 50%; }
#welcomeCard .pips2 .pip:nth-child(1) { top: 20%; left: 20%; }
#welcomeCard .pips2 .pip:nth-child(2) { top: 80%; left: 80%; }
#welcomeCard .pips3 .pip:nth-child(1) { top: 20%; left: 20%; }
#welcomeCard .pips3 .pip:nth-child(2) { top: 50%; left: 50%; }
#welcomeCard .pips3 .pip:nth-child(3) { top: 80%; left: 80%; }
#welcomeCard .pips4 .pip:nth-child(1) { top: 20%; left: 20%; }
#welcomeCard .pips4 .pip:nth-child(2) { top: 20%; left: 80%; }
#welcomeCard .pips4 .pip:nth-child(3) { top: 80%; left: 20%; }
#welcomeCard .pips4 .pip:nth-child(4) { top: 80%; left: 80%; }
#welcomeCard .pips5 .pip:nth-child(1) { top: 20%; left: 20%; }
#welcomeCard .pips5 .pip:nth-child(2) { top: 20%; left: 80%; }
#welcomeCard .pips5 .pip:nth-child(3) { top: 80%; left: 20%; }
#welcomeCard .pips5 .pip:nth-child(4) { top: 80%; left: 80%; }
#welcomeCard .pips5 .pip:nth-child(5) { top: 50%; left: 50%; }
#welcomeCard .pips6 .pip:nth-child(1) { top: 20%; left: 20%; }
#welcomeCard .pips6 .pip:nth-child(2) { top: 20%; left: 80%; }
#welcomeCard .pips6 .pip:nth-child(3) { top: 50%; left: 20%; }
#welcomeCard .pips6 .pip:nth-child(4) { top: 50%; left: 80%; }
#welcomeCard .pips6 .pip:nth-child(5) { top: 80%; left: 20%; }
#welcomeCard .pips6 .pip:nth-child(6) { top: 80%; left: 80%; }


/* Correct 3D face orientations (taken from original file) */
#welcomeCard .cube .f1 { transform: rotateY(0deg)    translateZ(4vh); }
#welcomeCard .cube .f2 { transform: rotateY(90deg)   translateZ(4vh); }
#welcomeCard .cube .f3 { transform: rotateY(180deg)  translateZ(4vh); }
#welcomeCard .cube .f4 { transform: rotateY(-90deg)  translateZ(4vh); }
#welcomeCard .cube .f5 { transform: rotateX(90deg)   translateZ(4vh); }
#welcomeCard .cube .f6 { transform: rotateX(-90deg)  translateZ(4vh); }




/* Special Monopoly face (replaces pip with an image) */
#welcomeCard .special-face {
    background: #ffffff;       /* white dice face */
    display: flex;
    justify-content: center;
    align-items: center;
}

#welcomeCard .mono-face-icon {
    width: 85%;                /* adjust size */
    height: 85%;
    object-fit: contain;
}



#welcomeCard {
   border: 1vh solid transparent;
   border-radius: 20vh;
   background-clip: padding-box;
}

#transportStage{
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
overflow:hidden;
pointer-events:none;
z-index:-2;
}







/* =========================================
   MONEY RAIN ANIMATION
========================================= */

#welcomeCard .money-rain {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
    z-index: -3; /* above background, below dice */
}

#welcomeCard .money-drop {
    position: absolute;
    width: 6vh;
    height: auto;
    opacity: 0;
    pointer-events: none;
    animation: moneyFall 6s linear forwards;
}

@keyframes moneyFall {
    0% {
        transform: translateY(-10vh) rotate(0deg) scale(1);
        opacity: 1;
    }
    40% {
        opacity: 1;
    }
    100% {
        transform: translateY(70vh) rotate(90deg) scale(0.9);
        opacity: 0;
    }
}






/* Wrapper for banner + guy */
.monopoly-wrapper {
    position: relative;       /* allows absolute positioning inside */
    width: calc(fit-content + 15vh);
    margin: 0 auto;
    margin-top: -15vh;
}

/* Monopoly Banner */
.monopoly-banner {
    padding: 1vh 10vh;
    background: #c20000;
    color: white;
    font-family: "Arial Black", "Helvetica Black", sans-serif;
    font-size: 6vh;
    font-weight: 900;
    letter-spacing: 0.6vh;

    border-radius: 1.2vh;
    border: 0.5vh solid #000;
    text-transform: uppercase;
    text-align: center;


    box-shadow:
       0 0.4vh 1vh rgba(0,0,0,0.35),
       inset 0 0 0.8vh rgba(255,255,255,0.35);
}

/* Monopoly Guy overlapping the banner */
.monopoly-guy-overlap {
    position: absolute;
    left: 57%;
    transform: translateX(130%) translateY(7%); /* X moves sideways, Y lifts */
    bottom: 0;
    height: 14vh;
    z-index: 10;
    pointer-events: none;
}



/* PNG tile icons */
.tile-icon {
    width: 8vh;
    height: 8vh;
    object-fit: contain;
    margin-bottom: 0vh;
    pointer-events: none;
}





/* =====================================================================
   CAR
===================================================================== */

.car img {
    width: 100%;
}

/* smoke container */
.car-smoke-container {
    position: absolute;
    top: 3.5vh;
    left: 0vh;
    pointer-events: none;
}

/* smoke puff */
.car-smoke {
    position: absolute;
    width: 1vh;
    height: 1vh;
    background: rgba(180,180,180,1);
    border-radius: 50%;
    animation: carSmokePuff 2.4s ease-out forwards;
}

@keyframes carSmokePuff {
    0%   { transform: translateX(-1vh) translateY(0vh) scale(0.8); opacity: 0.9; }
    40%  { opacity: 1; }
    100% { transform: translateX(-12vh) translateY(-1.7vh) scale(2.5); opacity: 0; }
}

@keyframes carCycle {
    0% {left: -30vh;transform: scaleX(1) rotate(0deg); /* NO wheelie */}
    40% {left: 110%;  transform: scaleX(1) rotate(0deg); /* stays flat */}
    /* -----------------------
       TURN AROUND (very small tilt)
       ----------------------- */
    45% {left: 110%; transform: scaleX(1) rotate(0deg);  /* tiny tilt, optional */ }
    50% {left: 110%;transform: scaleX(-1) rotate(0deg); /* face left */}
    /* -----------------------
       MOVE LEFT (slow, uniform)
       ----------------------- */
    90% {left: -30vh;transform: scaleX(-1) rotate(0deg); /* stays flat */}
    /* -----------------------
       TURN AGAIN BACK TO RIGHT
       ----------------------- */
    95% { left: -30vh;transform: scaleX(-1) rotate(0deg);}
    100% {left: -30vh;transform: scaleX(1) rotate(0deg); /* ready again */ }
}


.car_tread{
    width:1.7vh;
    height:1.7vh;
    position:absolute;
    bottom:1vh;
    border-radius:50%;
    background:radial-gradient(circle,#000 0.5 50%,#777 40% 60%,#000 75% 100%);
    animation:car_treadSpin .35s linear infinite;
    z-index:2;
}


.car_tread::before,
.car_tread::after{
    content:"";
    position:absolute;
    left:50%;
    top:50%;
    background:#222;
    transform:translate(-50%,-50%);}

.car_tread::before{width:3px;height:70%;box-shadow:
        -1px -1px 0 0 #222,
         1px  1px 0 0 #222; }

.car_tread::after{width:70%;height:3px;box-shadow:
        -1px  1px 0 0 #222,
         1px -1px 0 0 #222;  }



@keyframes car_treadSpin{
0%{transform:rotate(0);}
100%{transform:rotate(360deg);}
}

.car .car_tread:nth-child(4){left:1.9vh;}
.car .car_tread:nth-child(5){left:10.7vh;}



.car-track-shadow{
position:absolute;
bottom:.6vh;
left:2vh;
width:8vh;
height:.4vh;
background:rgba(0,0,0,.25);
filter:blur(0.2vh);
border-radius:.3vh;
z-index:0;
}
@keyframes carTrackMove{
0%{background-position:0 0;}
100%{background-position:-2vh 0;}
}



/* =====================================================================
   SCOOTER
===================================================================== */

.scooter {
    transform-origin: 4vh 100%;
}

.scooter img {
    width: 100%;
}

.scooter-smoke-container {
    position: absolute;
    top: 6vh;
    left: 0vh;
    pointer-events: none;
}

/* smoke puff */
.scooter-smoke {
    position: absolute;
    width: 0.5vh;
    height: 0.5vh;
    background: rgba(180,180,180,0.3);
    border-radius: 50%;
    animation: carSmokePuff 2.4s ease-out forwards;
}

@keyframes scooterSmokePuff {
    0%   { transform: translateX(0) translateY(0) scale(0.7); opacity: 1; }
    100% { transform: translateX(-6vh) translateY(-1vh) scale(1.7); opacity: 0; }
}

@keyframes scooterCycle{
0%{left:-30vh;transform:scaleX(1)rotate(-18deg);}
5%{left:-10vh;transform:scaleX(1)rotate(0deg);}
10%{left:10vh;transform:scaleX(1)rotate(-18deg);}
20%{left:40vh;transform:scaleX(1)rotate(-18deg);}
25%{left:25vh;transform:scaleX(1)rotate(0deg);}
55%{left:210vh;transform:scaleX(1)rotate(0deg);}
60%{left:210vh;transform:scaleX(-1)rotate(0deg);}
90%{left:0vh;transform:scaleX(-1)rotate(0deg);}
100%{left:-50vh;transform:scaleX(-1)rotate(0deg);}
}



.scooter_tread{
    width:1.73vh;
    height:1.73vh;
    position:absolute;
    bottom:1.25vh;
    border-radius:50%;
    background: radial-gradient(circle,#444 0 40%, #bbb 15% 10%, #444 75% 100%);
    animation:scooter_treadSpin .35s linear infinite;
    z-index:2;
}


.scooter_tread::before,
.scooter_tread::after{
    content:"";
    position:absolute;
    left:50%;
    top:50%;
    background:#444;
    transform:translate(-50%,-50%);}

.scooter_tread::before{width:3px;height:70%;box-shadow:
        -1px -1px 0 0 #444,
         1px  1px 0 0 #444; }

.scooter_tread::after{width:70%;height:3px;box-shadow:
        -1px  1px 0 0 #444,
         1px -1px 0 0 #444;  }



@keyframes scooter_treadSpin{
0%{transform:rotate(0);}
100%{transform:rotate(360deg);}
}

.scooter .scooter_tread:nth-child(4){left:2vh;}
.scooter .scooter_tread:nth-child(5){left:11.2vh;}





.scooter-track-shadow{
position:absolute;
bottom:.6vh;
left:2vh;
width:8vh;
height:.4vh;
background:rgba(0,0,0,.3);
filter:blur(0.3vh);
border-radius:.35vh;
z-index:0;
}
@keyframes scooterTrackMove{
0%{background-position:0 0;}
100%{background-position:-2vh 0;}
}


/* =====================================================================
   TANK
===================================================================== */

.tank img {
    width: 100%;
}

.tank-smoke-container {
    position: absolute;
    top: 7vh;
    left: 1vh;
}

.tank-smoke {
    position: absolute;
    width: 1.5vh;
    height: 1.5vh;
    background: rgba(80,80,80,0.8);
    border-radius: 50%;
    animation: tankSmokePuff 3s ease-out forwards;
}

@keyframes tankSmokePuff {
    0%   { transform: translateX(-2vh) translateY(0vh) scale(0.8); opacity: 1; }
    100% { transform: translateX(-14vh) translateY(-2vh) scale(3); opacity: 0; }
}

@keyframes tankCycle {
    0%   { left: -30vh; transform: scaleX(1); }
    45%  { left: 120vh; transform: scaleX(1); }
    50%  { transform: scaleX(-1); }
    95%  { left: -30vh; transform: scaleX(-1); }
    100% { transform: scaleX(1); }
}

.tread{
    width:3vh;
    height:3vh;
    position:absolute;
    bottom:1.2vh;
    border-radius:50%;
    background:radial-gradient(circle,#000 0 30%,#777 31% 60%,#000 61% 100%);
    animation:treadSpin .35s linear infinite;
    z-index:2;
}


.tread::before,
.tread::after{
    content:"";
    position:absolute;
    left:50%;
    top:50%;
    background:#222;
    transform:translate(-50%,-50%);}

.tread::before{width:3px;height:70%;box-shadow:
        -1px -1px 0 0 #222,
         1px  1px 0 0 #222; }

.tread::after{width:70%;height:3px;box-shadow:
        -1px  1px 0 0 #222,
         1px -1px 0 0 #222;  }



@keyframes treadSpin{
0%{transform:rotate(0);}
100%{transform:rotate(360deg);}
}

.tank .tread:nth-child(4){left:1.7vh;}
.tank .tread:nth-child(5){left:4.65vh;}
.tank .tread:nth-child(6){left:7.6vh;}
.tank .tread:nth-child(7){left:10.4vh;}
.tank .tread:nth-child(8){left:13.35vh;}



.tank-track-shadow{
position:absolute;
bottom:0;
left:.2vh;
width:15vh;
height:.8vh;
background:rgba(0,0,0,.4);
filter:blur(0.3vh);
border-radius:1vh;
z-index:0;
}
@keyframes tankTrackMove{
0%{background-position:0 0;}
100%{background-position:-3vh 0;}
}








/* ==========================
   BOOMERANG HAT VEHICLE
========================== */

.vehicle.boomerang-hat {
    width: 10vh;      /* adjust as needed */
    height: 10vh;
    position: absolute;
    left: -40vh;
    bottom: 4vh;
    opacity: 0;
    z-index: -1;
}

.hatWrap {
    position:absolute;
    width:200px;
    height:200px;
    transform-style:preserve-3d;
}

.hatWrap .hat {
    position:absolute;
    width:180px;
    left:0;
    top:0;
}

.hatWrap .hatShadow {
    position:absolute;
    left:40px;
    top:130px;
    width:120px;
    height:40px;
    border-radius:50%;
    background:rgba(0,0,0,0.35);
    filter:blur(8px);
    transform-origin:center;
    z-index:-1;
}





/* =====================================================================
   FERRY
===================================================================== */

.ferry-wrapper {
    position: absolute;
    bottom: 20vh;
    width: 26vh;
    left: -30vh;
    opacity: 0;
z-index:4;
}
.ferry {
    width: 26vh;
z-index:4;
}

.ferry-smoke-container {
    position: absolute;
    top: -0.2vh;
    left: 8vh;
}

.ferry-smoke {
    position: absolute;
    width: 2vh;
    height: 2vh;
    border-radius: 50%;
    background: rgba(200,200,200,0.5);
    animation: smokePuff 2s ease-out forwards;
}

@keyframes smokePuff {
    0%   { transform: translateX(-2vh) translateY(0vh) scale(0.8); opacity: 1; }
    100% { transform: translateX(-14vh) translateY(-2vh) scale(3); opacity: 0; }
}

@keyframes ferryCycle {
    0%   { left:-40vh; transform:scaleX(1); }
    50%  { left:120vh; transform:scaleX(1); }
    55%  { transform:scaleX(-1); }
    100% { transform:scaleX(-1); }
}
@keyframes ferryBob {
    0%,100%{ bottom:20vh }
    50%{ bottom:22vh }
}


.ferry-wake{
position:absolute;
bottom:-1vh;
left:-4vh;
width:32vh;
height:2vh;
background:repeating-linear-gradient(90deg,rgba(0, 158, 248,.7) 0 .7vh,rgba(0, 158, 230, 1) .7vh 1.4vh);
border-radius:1vh;
opacity:1;
filter:blur(1.3vh);
animation:ferryWakeMove .5s linear infinite;
z-index:0;
}
@keyframes ferryWakeMove{
0%{background-position:0 0;}
100%{background-position:-3vh 0;}
}


/* ============================
   WATER ANIMATION LAYER
============================ */
#waterStage{
    position:absolute;
    bottom:-2vh;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
    opacity:0;
    z-index:-1;
    overflow:hidden;
}

#waterStage .water{
    position:absolute;      /* fixed, you typed position:-1vh by mistake */
    width:140%;
    height:200px;
    left:-20%;
  bottom:-150px;
    height:260px;            /* LOWER starting water line */
    overflow:hidden;
    animation:waterLevel 6s ease-in-out forwards;
}


#waterStage .wave{
position:absolute;
width:200%;
height:200%;
left:-50%;
top:20px;
background:radial-gradient(circle at 50% 10%,rgba(255,255,255,.12),rgba(0,0,0,0) 60%),
linear-gradient(to bottom,#1e6ea6 0%,#0d4f7d 60%,#073153 100%);
border-radius:55% 45% 0 0;
animation:hill 6s ease-in-out infinite;
}

#waterStage .shadow{
position:absolute;
top:110px;
width:200%;
height:60px;
left:-50%;

filter:blur(10px);
animation:hill 6s ease-in-out infinite;
}

@keyframes hill{
0%{transform:translateX(0) translateY(0) scaleX(0.9);}
50%{transform:translateX(-8%) translateY(-6px) scaleX(1.08);}
100%{transform:translateX(0) translateY(0) scaleX(1.05);}
}

@keyframes waterLevel{
0%{transform:translateY(10px);}
30%{transform:translateY(-10px);}
50%{transform:translateY(-14px);}
70%{transform:translateY(-10px);}
90%{transform:translateY(-13px);}
100%{transform:translateY(-10px);}
}



@keyframes waterLevelDown {
    0%   { transform: translateY(10px); }
    100% { transform: translateY(400px); }
}




/* ============================
   All vehicle
============================ */
.vehicle {
    width:12vh;        /* MUCH better scale inside welcome card */
    bottom:-0.1vh;        /* sits naturally on welcome card floor */
    left:-20vh;        /* keeps vehicles fully hidden until animation starts */
    opacity:0;
    position:absolute;
    pointer-events:none;
    z-index:1;
}
.vehicle.car { width:14vh; }
.vehicle.scooter { width:14vh; }
.vehicle.tank { width:18vh; }
.vehicle.ferry-wrapper { width:26vh; bottom:2vh !important; z-index:400;}
.vehicle.boomerang-hat { width:14vh; bottom:5vh !important; }




/* ============================
      PARROT NPC STYLES
============================ */


#parrot {
    position: absolute;
    width: 150px;
    height: 150px;
    transform-origin: center;
    pointer-events: none;
    z-index: 9999;
    animation: bobbing 3.5s ease-in-out infinite;
}

@keyframes bobbing {
    0%   { transform: translateY(0px); }
    50%  { transform: translateY(-6px); }
    100% { transform: translateY(0px); }
}

@keyframes flap {
    0% { transform: rotateZ(0deg); }
    50% { transform: rotateZ(20deg); }
    100% { transform: rotateZ(0deg); }
}

.wing {
    transform-origin: top center;
    animation: flap 0.35s ease-in-out infinite;
}

@keyframes eyeLook {
    0%   { transform: translate(0,0); }
    25%  { transform: translate(2px,1px); }
    50%  { transform: translate(-2px,0px); }
    75%  { transform: translate(1px,-2px); }
    100% { transform: translate(0,0); }
}

.pupil {
    animation: eyeLook 2.2s infinite ease-in-out;
}

@keyframes jump {
    0%   { transform: translateY(0); }
    40%  { transform: translateY(-30vh); }
    100% { transform: translateY(0); }
}



#parrot { z-index: 10 !important; }


@keyframes hoverShake {
    0%   { transform: translateY(-2px) translateX(0px); }
    50%  { transform: translateY(1px) translateX(2px); }
    100% { transform: translateY(-2px) translateX(0px); }
}



.modal-overlay,
.modal,
#popupContainer {
    z-index: 100000 !important;
}




#eventLog {
    position: absolute;
    top: 12vh;
    right: 5vh;
    width: 45vh;
    max-height: 60vh;
    overflow-y: auto;
    background: rgba(255,255,255,0.95);
    border-radius: 2vh;
    padding: 2vh;
    box-shadow: 0 0 15px rgba(0,0,0,.3);
    font-size: 2vh;
    z-index: 999999;
    transition: opacity 0.3s ease;
}

#eventLog.hidden {
    display: none;
}

.log-group h3 {
    margin:0 0 1vh 0;
    padding:0.5vh 1vh;
    border-radius:1vh;
    font-size:2vh;
}

.log-group ul {
    margin:0 0 2vh 1vh;
    padding:0;
    list-style-type:disc;
}

/* category header colors */
.log-group.community h3  { background: var(--community-color);  color:white; }
.log-group.chance h3     { background: var(--chance-color);     color:white; }
.log-group.radio h3      { background: var(--radio-color);      color:white; }
.log-group.restaurant h3 { background: var(--restaurant-color); color:white; }
.log-group.park h3       { background: var(--garden-color);     color:white; }
.log-group.casino h3     { background: var(--casino-color);     color:white; }
.log-group.farm h3     { background: var(--farm-color);     color:white; }
.log-group.mall h3     { background: var(--mall-color);     color:white; }




.log-icon {
    width: 3vh;
    height: 3vh;
    vertical-align: middle;
    margin-right: 1vh;
}
.log-close-btn {
    position:absolute;
    top: 1vh;
    right: 1vh;
    font-size: 2.5vh;
    cursor:pointer;
    padding: 0.5vh 1vh;
    border-radius: 1vh;
    background: rgba(0,0,0,0.1);
}
.log-close-btn:hover {
    background: rgba(0,0,0,0.2);
}



/* RADIO LOG COLORS MATCHING ROOT VARS */
.radio-log-red      { color: var(--radio-red); }
.radio-log-green    { color: var(--radio-green); }
.radio-log-purple   { color: var(--radio-purple); }
.radio-log-blue     { color: var(--radio-blue); }
.radio-log-yellow   { color: var(--radio-yellow); }



/* ===== PARK MULTIPLIER ANIMATION (from park.html) ===== */

.park-card-container{
    display:flex;
    gap:2.5vh;
    justify-content:center;
    margin-top:2vh;
}


.park-mini{
    width:6vh;                 /* slightly wider */
    height:36vh;               /* match card height */
    display:flex;
    align-items:center;
    justify-content:center;

    font-size:8vh;             /* ‚¨Ü MUCH bigger √ó and = */
    font-weight:900;
    color:#ffffff;             /* white for contrast */

    opacity:0;
    transform:scale(0.5);
}


.park-show{
    animation:parkPop 0.45s ease-out forwards;
}

@keyframes parkPop{
    from{opacity:0; transform:scale(.5);}
    to{opacity:1; transform:scale(1);}
}

.park-card{
    width:30vh;                   /* ‚¨Ö wider */
    height:36vh;                  /* ‚¨Ö taller */
    background:white;
    border-radius:2vh;
    box-shadow:0 12px 30px rgba(0,0,0,.35);

    display:flex;
    flex-direction:column;
    align-items:center;

    opacity:0;
    transform:scale(0.5);
}

.park-banner{
    width:100%;
    height:6.2vh;                 /* ‚úÖ fixed banner height */
    display:flex;
    align-items:center;
    justify-content:center;

    background:var(--garden-color);
    color:white;

    font-weight:800;
    font-size:3vh;
    letter-spacing:0.15vh;
}



.park-emoji{ font-size:5.2vh; margin-top:2.5vh; }
.park-label{ font-size:5.2vh; font-weight:700; }

.park-stars{
    margin-top:auto;
    width:100%;
    padding:1.2vh 0;

    display:grid;
    grid-template-columns: repeat(2, max-content); /* ‚Üê IMPORTANT */
    justify-content:center;
    align-content:center;

    gap:1vh 1.6vh;   /* row-gap | column-gap */

    font-size:4vh;
    height:4.2vh;              /* üîí fixed height */
  
    background:var(--garden-color);
    color:gold;
}



/* white area container */
.park-star-body{
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ‚≠ê‚≠ê STAR GRID ‚Äî 2 PER ROW */
.park-star-grid{
    display: grid;
    grid-template-columns: repeat(2, max-content);
    gap: 1.2vh 2vh;
    place-items: center;
    font-size: 5vh;
}

/* Park action buttons */
.park-controls{
    display:flex;
    gap:3vh;
    justify-content:center;
    margin-top:4vh;
}

.park-action-btn{
    padding:1.4vh 5vh;
    font-size:2.6vh;
    font-weight:900;
    border:none;
    border-radius:1.2vh;
    cursor:pointer;

    background:var(--garden-color);
    color:white;

    box-shadow:0 0 20px rgba(68,121,0,0.6);
    transition:.2s;
}

.park-action-btn:hover{
    transform:scale(1.05);
    box-shadow:0 0 30px rgba(68,121,0,0.9);
}

.park-action-btn.reset{
    background:#666;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
}




/* ================= FARM ANIMATION (EXACT COPY) ================= */




.textLabel{
  font-family:'Roboto',sans-serif;
  font-weight:900;
  letter-spacing:.5px;
}

.wrap{width:min(900px,95vw);display:grid;gap:16px}

.selector{display:flex;justify-content:center;gap:16px;margin-bottom:8px}

.rbtn{
  padding:14px 22px;
  border-radius:14px;
  font-weight:700;
  cursor:pointer;
  border:3px solid transparent;
  color:#fff;
  transition:.25s;
  box-shadow:0 0 20px rgba(0,0,0,.4);
  font-family:'Roboto',sans-serif;

  opacity:0.4;              /* ‚¨Ö dim by default */
  filter:grayscale(40%);
}

.rbtn.active{
  opacity:1;
  filter:none;
  transform:scale(1.1);
  box-shadow:
    0 0 30px rgba(255,255,255,0.6),
    0 0 60px rgba(255,255,255,0.3);
}

.rbtn:hover{transform:scale(1.05)}
.rbtn.terai{background:#5EB65F;border-color:#00ff99;box-shadow:0 0 14px #5EB65F}
.rbtn.hills{background:#ff8c00;border-color:#ffb347;box-shadow:0 0 14px #ffb347}
.rbtn.himal{background:#00ccff;border-color:#80f2ff;box-shadow:0 0 14px #80f2ff}

.panel{
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;padding:20px;
  backdrop-filter:blur(6px);
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.stage{
  position:relative;
  display:grid;
  place-items:center;
  aspect-ratio:1/1;
  width:min(400px,88vw);
  margin:auto;
}

.wheel{
  width:100%;
  height:100%;
  border-radius:50%;
  border:10px solid #1b2550;
  background:#0f1630;
  display:grid;
  place-items:center;
  position:relative;
  box-shadow:
    inset 0 0 0 4px rgba(255,255,255,.06),
    0 12px 40px rgba(0,0,0,.5);
}
.wheel svg{width:92%;height:92%}

.hub{
  position:absolute;
  width:120px;
  height:120px;
  border-radius:50%;
  background:#0c1436;
  border:6px solid #1f2b63;
  display:grid;
  place-items:center;
  cursor:pointer;
  font-weight:700;
  color:#90f7ff;
  letter-spacing:.08em;
  box-shadow:inset 0 0 0 4px rgba(255,255,255,.06);
  transition:transform .06s ease;
}
.hub:active{transform:scale(.97)}

.pointer{
  position:absolute;
  top:-6px;
  left:50%;
  transform:translateX(-50%);
  width:0;height:0;
  border-left:18px solid transparent;
  border-right:18px solid transparent;
  border-bottom:32px solid var(--pointer);
  filter:
    drop-shadow(0 0 12px var(--pointer))
    drop-shadow(0 0 22px var(--pointer));
}
.pointer-base{
  position:absolute;
  top:12px;
  left:50%;
  transform:translateX(-50%);
  width:18px;
  height:18px;
  background:var(--pointer);
  border-radius:50%;
  box-shadow:0 0 10px 2px var(--pointer);
}

.sector.active{
  stroke:#fff;
  stroke-width:1.3;
  transform:scale(1.02);
  transform-origin:60px 60px;
}
.textLabel.active{
  paint-order:stroke;
  stroke:rgba(255,255,255,.9);
  stroke-width:.6;
}

.result-card{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
  padding:18px;
  box-shadow:0 8px 24px rgba(0,0,0,.4);
}

.banner{
  background:var(--banner);
  padding:12px;
  border-radius:10px;
  text-align:center;
  font-size:26px;
  font-weight:900;
  color:#fff;
  margin-bottom:12px;
  box-shadow:none;
}


.resline{
  margin:6px 0;
  font-size:20px;
  font-weight:300;
  color: white;

  min-height: 5vh;        /* ‚úÖ minimum height */
  display: flex;
  align-items: center;     /* vertically center short text */
}




/* ================= CASINO GAME (EXACT COPY) ================= */

#casinoScreen h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    text-shadow: 0 0 20px gold;
    color: white;
}

/* SLOT MACHINE FRAME */
.slot-machine {
    background: #111;
    padding: 20px 30px;
    border-radius: 25px;
    box-shadow: 0 0 35px rgba(255,255,255,0.25);
    display: flex;
    align-items: center;
    gap: 25px;
}

/* REELS */
.reels {
    display: flex;
    gap: 15px;
}

.reel-container {
    width: 90px;
    height: 120px;
    overflow: hidden;
    border-radius: 12px;
    background: #222;
    box-shadow: inset 0 0 15px rgba(0,0,0,0.6);
}

.reel-strip {
    display: flex;
    flex-direction: column;
    font-size: 4rem;
}

/* LEVER */
.lever-area {
    width: 80px;
    height: 180px;
    cursor: pointer;
    position: relative;
}

.lever-stick {
    width: 12px;
    height: 110px;
    background: #555;
    border-radius: 8px;
    position: absolute;
    left: 34px;
    top: 0;
    transition: transform 0.2s;
}

.lever-knob {
    width: 35px;
    height: 35px;
    background: red;
    border-radius: 50%;
    position: absolute;
    top: 110px;
    left: 22px;
    box-shadow: 0 0 15px red;
    transition: transform 0.2s;
}

.pull .lever-stick { transform: rotate(25deg); }
.pull .lever-knob { transform: translateY(20px); }

/* WIN GLOW */
.win-glow {
    animation: glow 0.8s infinite alternate;
}

@keyframes glow {
    0% { box-shadow: 0 0 15px gold; }
    100% { box-shadow: 0 0 30px yellow; }
}

#result {
    margin-top: 20px;
    font-size: 2rem;
    height: 50px;
    text-shadow: 0 0 15px gold;
    color:white;
}

/* CASINO POPUP */
.casino-popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    justify-content: center;
    visibility: hidden;
    opacity: 0;
    transition: 0.3s;
    pointer-events: none;
    z-index: 300000;
align-items: flex-end;
padding-bottom: 10vh; 
}

.casino-popup-overlay.show {
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
}

.casino-popup-box {
    background: rgb(250,240,190);
    color: black;
    padding: 25px 35px;
    border-radius: 15px;
    text-align: center;
    font-size: 1.7rem;
    box-shadow: 0 0 20px gold;
    transform: scale(0.5);
    transition: 0.3s;
}

.casino-popup-box.show {
    transform: scale(1);
}

.casino-popup-button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: rgb(255,204,0);
    color: white;
    box-shadow: 0 0 15px #ffd700;
}



/* ================= SHOPPING MALL ‚Äî BLUE THEME ================= */

.calendar{
    width:450px;
    height:37vh;
    background: linear-gradient(180deg, #ffffff, #f4f7ff);
    border-radius:18px;

    perspective:1200px;
    position:relative;
    padding: 5px 15px;
    margin-bottom:2vh;
}

.page{
    width:100%;
    height:100%;
    position:absolute;
    top:0; left:0;
    backface-visibility:hidden;
    transform-style:preserve-3d;
    border-radius:14px;
    background:white;
    padding:12px;
    box-sizing:border-box;
}

/* ===== MONTH TITLE ===== */
.month-title{
    text-align:center;
    font-size:3.4vh;
    font-weight:900;
    margin-bottom:1.5vh;
    color:Gold; /* dark gold */
    letter-spacing:.08vh;

    /* dark gold stroke */
    -webkit-text-stroke:0.12vh #6b4f00;

}


/* ===== WEEKDAY HEADER ===== */
.days-grid{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:1.2vh;
    font-size:2.2vh;
}

.day-name{
    font-weight:700;
    text-align:center;
    background:#e7edff;
    color:#0b3c78;
    padding:.6vh 0;
    border-radius:.8vh;
}

.day-name.saturday-header{
    background:#ffdede;
    color:#b00000;
}

/* ===== DAYS ===== */
.day{
    text-align:center;
    padding:.7vh 0;
    border-radius:.8vh;
    font-weight:600;
    transition:.15s;
}

.day:hover{
    background:#e7edff;
}

/* Saturdays */
.saturday{
    color:#d00000;
    font-weight:700;
}

/* ===== HOLIDAYS ===== */
.holiday{
    background: linear-gradient(135deg,#ffeded,#ffd6d6);
    color:#b00000 !important;
    font-weight:900;
    box-shadow: inset 0 0 0 1px rgba(255,0,0,0.25);
}

/* ===== TOP BANNER (Pick a Month) ===== */
#pickMonthBanner{
    width:450px;
    height:7.5vh;
padding: 5px 15px;
    display:flex;
    align-items:center;
    justify-content:center;     /* ‚úÖ center align */

    background: linear-gradient(135deg,#0b7cff,#0050c8);

    color:white;
    font-size:4vh;
    font-weight:900;
    letter-spacing:0.15vh;

    border-radius:1.4vh;

    border:0.4vh solid #2da3ff;   /* üîµ blue border */
    box-shadow:
        0 0 20px rgba(0,140,255,.6),
        inset 0 0 10px rgba(255,255,255,0.25);

    cursor:pointer;
    margin-bottom:1vh;
}



/* ===== EXPENSES BANNER ===== */
#incomeBanner{
    width:450px;
    height:7.5vh;
    display:flex;
    align-items:center;
    justify-content:center;
padding: 5px 15px;

    background: linear-gradient(135deg,#0b7cff,#0050c8);

    color:white;                 /* ‚úÖ white text */
    font-size:4vh;             /* ‚úÖ same as Park Draw */
    font-weight:900;
    letter-spacing:0.15vh;

    border-radius:1.4vh;
    box-shadow:0 0 20px rgba(0,140,255,.6);
    margin-top:2vh;
    margin-bottom:1vh;
}

/* ===== Shopping Mall expense highlight ===== */
@keyframes mallExpensePulse {
    0%   { transform: scale(1); }
    30%  { transform: scale(1.15); }
    55%  { transform: scale(0.97); }
    75%  { transform: scale(1.05); }
    100% { transform: scale(1); }
}

#incomeBanner.pulse{
    animation: mallExpensePulse 0.8s ease-out;
}


/* ===== INFO BOX ===== */
#infoBox{
    width:450px;
padding: 5px 15px;
    min-height:31vh;
    background:white;
    border-radius:0 0 1.6vh 1.6vh;
    box-shadow:0 12px 30px rgba(0,0,0,.25);
    padding:2vh;
    font-size:1.8vh;
    line-height:1.5;

    border-radius:1.4vh;
    letter-spacing:.12vh;
    box-shadow:0 0 20px rgba(0,140,255,.6);
}

/* Holiday list styling */
#infoBox b.holiday-title{
    color:#c00000;
    font-size:2.4vh;
}

#infoBox .holiday-item{
    color:#c00000;
    font-weight:700;
}

/* ===== FLIP ANIMATION ===== */
.flip{
    animation:flipPage .22s cubic-bezier(.4,.0,.2,1) forwards;
}

@keyframes flipPage{
    0%{transform:rotateX(0deg);}
    100%{transform:rotateX(-180deg);}
}



/* =========================================================
   MOBILE RESPONSIVE OVERRIDES (SAFE)
   DO NOT EDIT DESKTOP CSS ABOVE
========================================================= */

@media (max-width: 768px) {

  /* ---------- PAGE ---------- */
  body {
    padding: 10px;
    height: auto;
    overflow-y: auto;
  }

  /* ---------- MAIN LAYOUT ---------- */
  .layout {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: auto;
  }

  .left-panel,
  .center-panel,
  .far-right-panel {
    width: 100%;
    align-items: center;
    margin: 0;
    padding: 0;
  }

  .far-right-panel {
    padding-top: 0;
  }

  /* ---------- BUTTONS ---------- */
  .draw-btn,
  .big-btn {
    width: 90%;
    max-width: 420px;
    height: auto;
    padding: 14px;
    font-size: 16px;
  }

  .icon {
    font-size: 22px;
  }

  .tile-icon {
    width: 32px;
    height: 32px;
  }

  .bottom-buttons {
    flex-direction: column;
    width: 100%;
    gap: 12px;
  }

  /* ---------- WELCOME CARD ---------- */
  #welcomeCard {
    width: 100%;
    height: auto;
    padding: 20px;
    border-radius: 20px;
  }

  #welcomeTitle {
    font-size: 24px;
    margin: 10px 0;
  }

  #welcomeText {
    font-size: 16px;
  }

  /* ---------- DICE ---------- */
  #welcomeCard .dice-wrap {
    gap: 16px;
    margin: 10px 0;
  }

  #welcomeCard .dice-scene {
    width: 60px;
    height: 60px;
  }

  /* ---------- MONOPOLY BANNER ---------- */
  .monopoly-wrapper {
    margin-top: 0;
  }

  .monopoly-banner {
    font-size: 26px;
    padding: 8px 20px;
    letter-spacing: 2px;
  }

  .monopoly-guy-overlap {
    height: 70px;
    transform: translateX(90%) translateY(10%);
  }

  /* ---------- POPUPS ---------- */
  .modal {
    width: 92%;
    max-height: 80vh;
    padding: 16px;
  }

  .modal h2 {
    font-size: 22px;
  }

  .modal p {
    font-size: 16px;
    line-height: 1.4;
  }

  .close-btn {
    font-size: 22px;
  }

  /* ---------- TOP BUTTONS ---------- */
  .sound-btn {
    width: 44px;
    height: 44px;
    font-size: 22px;
  }

  #soundToggle {
    right: 10px;
    top: 10px;
  }

  /* ---------- EVENT LOG ---------- */
  #eventLog {
    position: fixed;
    top: 60px;
    right: 10px;
    width: 90%;
    max-width: 420px;
    font-size: 14px;
  }

  /* ---------- PARROT ---------- */
  #parrot {
    width: 90px;
    height: 90px;
  }

}



</style>







</head>
<body>
<div id="eventLog" class="hidden">
    <div class="log-close-btn" onclick="toggleLog()">‚úñ</div>

  <div class="log-group radio">
        <h3><img src="media/radio.png" class="log-icon"> Radio</h3>
        <ul id="logRadio"></ul>
    </div>

<div class="log-group chance">
        <h3>‚ùì &nbsp &nbsp Chance</h3>
        <ul id="logChance"></ul>
    </div>

    <div class="log-group community">
        <h3><img src="media/community.png" class="log-icon"> Community</h3>
        <ul id="logCommunity"></ul>
    </div>

    <div class="log-group restaurant">
        <h3><img src="media/restaurant.png" class="log-icon"> Restaurant</h3>
        <ul id="logRestaurant"></ul>
    </div>


<div class="log-group park">
    <h3><img src="media/park.png" class="log-icon"> Park</h3>
    <ul id="logPark"></ul>
</div>

<div class="log-group mall">
    <h3>üõçÔ∏è Shopping Mall</h3>
    <ul id="logShoppingMall"></ul>
</div>


<div class="log-group casino">
    <h3><img src="media/casino.png" class="log-icon"> Casino</h3>
    <ul id="logCasino"></ul>
</div>

<div class="log-group farm">
    <h3>üåæ Farm</h3>
    <ul id="logFarm"></ul>
</div>


</div>



<audio id="bgMusic"></audio>
<h1><br></h1>
<button id="soundToggle" class="sound-btn" onclick="toggleSound()">üîä</button>
<button id="helpButton" class="sound-btn" style="right: 10vh;" onclick="showHelp()">‚ùì</button>
<button id="logButton" class="sound-btn" style="right: 18vh;" onclick="toggleLog()">üìí</button>





<script>
/* ============================
   PARROT SOUND SYSTEM
============================ */
const parrotAudio = {
    idle: [
        "media/random_1.mp3",
        "media/random_2.mp3",
        "media/random_3.mp3",
        "media/random_4.mp3",
    ],
    fly: "media/normal_flight.mp3",
    danger: "media/danger_sound.mp3",
    escape: "media/danger_flap.mp3"
};

let parrotIdleSound = null;
let parrotFlySound = null;
let parrotDangerSound = null;
let parrotEscapeSound = null;

function playParrotSound(src, loop=false) {
    if (!audioUnlocked) return null;   // ‚¨Ö prevents blocked sounds

    const a = new Audio(src);
    a.loop = loop;
    a.volume = 0.35;

    a.play().catch(()=>{});
    return a;
}


function stopSound(a) {
    if (a) {
        a.pause();
        a.currentTime = 0;
    }
}
</script>









<!-- ü¶ú PARROT NPC -->
<div id="parrot">
<svg width="150" height="150" viewBox="0 0 200 200">

<defs>
    <linearGradient id="parrotGreenBody" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#9cff8a" />
        <stop offset="100%" stop-color="#3c9f45" />
    </linearGradient>

    <linearGradient id="parrotGreenHead" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#c8ffb5" />
        <stop offset="100%" stop-color="#4fae55" />
    </linearGradient>

    <linearGradient id="parrotGreenWing" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#b4ff9b" />
        <stop offset="100%" stop-color="#489c50" />
    </linearGradient>
</defs>


    <!-- Body -->
    <ellipse cx="100" cy="115" rx="45" ry="60" fill="url(#parrotGreenBody)" />


    <!-- Head -->
    <g id="head" style="transform-origin: 100px 70px;">
        <circle cx="100" cy="70" r="30" fill="url(#parrotGreenHead)" />


        <!-- Right eye -->
        <g>
            <circle cx="115" cy="62" r="10" fill="white" />
            <circle class="pupil" cx="115" cy="62" r="4" fill="black" />
        </g>

        <!-- Left eye -->
        <g>
            <circle cx="85" cy="62" r="10" fill="white" />
            <circle class="pupil" cx="85" cy="62" r="4" fill="black" />
        </g>
    </g>

    <!-- Beak -->
    <polygon points="70,80 100,80 100,62" fill="#cfa341" />

    <!-- Wings -->
    <polygon class="wing" points="70,110 20,140 78,150" fill="url(#parrotGreenWing)"  />
    <polygon class="wing" points="130,110 180,140 122,150" fill="url(#parrotGreenWing)"  />

    <!-- Tail -->
    <polygon points="100,175 75,195 125,195" fill="url(#parrotGreenWing)" />

    <!-- Legs -->
    <rect x="88" y="165" width="8" height="22" fill="#9c7a47" />
    <rect x="103" y="165" width="8" height="22" fill="#9c7a47" />

</svg>
</div>





<div class="layout">

    <!-- LEFT SIDE BUTTONS -->
    <div class="left-panel">
        <button class="draw-btn restaurant-btn" onclick="drawRestaurant()"><img src="media/restaurant.png" class="tile-icon">Restaurant</button>
        <button class="draw-btn park-btn" onclick="drawParkMultiplier()"><img src="media/park.png" class="tile-icon">Park</button>
<button class="draw-btn mall-btn" onclick="openShoppingMall()">üõçÔ∏è Shopping Mall</button>

        <button class="draw-btn casino-btn" onclick="event.stopPropagation(); openCasino();">
    <img src="media/casino.png" class="tile-icon">Casino
</button>

<button class="draw-btn farm-btn" onclick="event.stopPropagation(); openFarm();">
    üåæ Farm
</button>


    </div>

    <!-- CENTER PANEL (WELCOME + CHANCE + COMMUNITY) -->
    <div class="center-panel">
        <div id="welcomeCard" class="floating-welcome">

                <!-- ‚≠ê Vehicle animation layer (behind everything) -->
                <div id="transportStage">
<!-- WATER LAYER (must come before ferry) -->
<div id="waterStage">
    <div class="water">
        <div class="wave"></div>
        <div class="shadow"></div>
    </div>
</div>


                    <!-- ================= CAR ================= -->
                    <div class="vehicle car" data-vehicle="car" data-sound="media/car.mp3">

                        <div class="car-track"></div>
                        <div class="car-track-shadow"></div>
                        <img src="media/car.png">

<!-- 2 tread wheels (CSS positions them) -->
                        <div class="car_tread"></div>
                        <div class="car_tread"></div>
                        <div class="car-smoke-container"></div>
                    </div>

                    <!-- ================= SCOOTER ================= -->
                    <div class="vehicle scooter" data-vehicle="scooter" data-sound="media/scooter.mp3">

                        <div class="scooter-track"></div>
                        <div class="scooter-track-shadow"></div>
                        <img src="media/scooter.png">
<!-- 2 tread wheels (CSS positions them) -->
                        <div class="scooter_tread"></div>
			<div class="scooter_tread"></div>
                        <div class="scooter-smoke-container"></div>
                    </div>

                    <!-- ================= TANK ================= -->
                    <div class="vehicle tank" data-vehicle="tank" data-sound="media/tank.mp3">

                        <div class="tank-track-shadow"></div>
                        <div class="tank-track"></div>
                        <img src="media/tank.png">

                        <!-- 5 tread wheels (CSS positions them) -->
                        <div class="tread"></div>
                        <div class="tread"></div>
                        <div class="tread"></div>
                        <div class="tread"></div>
                        <div class="tread"></div>

                        <div class="tank-smoke-container"></div>
                    </div>




                    <!-- ================= FERRY ================= -->
                    <div class="vehicle ferry-wrapper" data-vehicle="ferry" data-sound="media/ferry.mp3">

                        <div class="ferry-wake-shadow"></div>
                        <div class="ferry-wake"></div>
                        <img src="media/ferry.png" class="ferry">
                        <div class="ferry-smoke-container"></div>
                    </div>



<!-- ================= BOOMERANG-HAT ================= -->
<div class="vehicle boomerang-hat"
     data-vehicle="boomerang-hat"
     data-sound="media/hat.mp3">
     
    <div class="hatWrap">
        <img class="hat" src="media/hat.png">
        <div class="hatShadow"></div>
    </div>

</div>





                </div>




<div class="money-rain"></div>

<div class="monopoly-wrapper">
    <div class="monopoly-banner">MONOPOLY</div>
    <img src="media/mono_guy.png" class="monopoly-guy-overlap">
</div>




<div class="dice-wrap">
    <div class="dice-scene">
        <div class="cube">
            <div class="face f1 special-face"><img src="media/mono_special_face.png" class="mono-face-icon"></div>
            <div class="face f2"><div class="pips pips2"><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f3"><div class="pips pips3"><div class="pip"></div><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f4"><div class="pips pips4"><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f5"><div class="pips pips5">
                <div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face f6"><div class="pips pips6">
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
        </div>
    </div>

    <div class="dice-scene">
        <div class="cube">
            <div class="face f1"><div class="pips pips1"><div class="pip"></div></div></div>
            <div class="face f2"><div class="pips pips2"><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f3"><div class="pips pips3"><div class="pip"></div><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f4"><div class="pips pips4"><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div></div></div>
            <div class="face f5"><div class="pips pips5">
                <div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face f6"><div class="pips pips6">
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
        </div>
    </div>
</div>




            <div id="welcomeTitle">
  Welcome to Monopoly <br>
  <span class="subtitle">
    Travel across Nepal, build places, and enjoy the adventure!
  </span>
</div>

            <div id="welcomeText">Click a tile to see the instructions</div>




        </div>

        <!-- RESTORED CHANCE / COMMUNITY BUTTONS -->
        <!-- TOP ACTIONS (RADIO + CHANCE + COMMUNITY) -->
<div class="top-actions">

    <button class="draw-btn radio-btn" onclick="drawRadio()">
        <img src="media/radio.png" class="tile-icon">Radio
    </button>

    <button class="big-btn big-chance" onclick="drawChance()">
        <div class="icon">‚ùì</div>Chance
    </button>

    <button class="big-btn big-community" onclick="drawCommunity()">
        <img src="media/community.png" class="tile-icon">Community
    </button>

</div>


</div>




<script>

function toggleLog() {
    document.getElementById("eventLog").classList.toggle("hidden");
}





let audioUnlocked = false;
/* =========================
   GLOBAL SOUND PAUSE / RESUME
========================= */

function pauseAllAmbientSounds(){
    // pause background music
    bgMusic.pause();

    // pause all vehicle sounds
    document.querySelectorAll(".vehicle").forEach(v=>{
        if (v._sound) v._sound.pause();
    });

    // pause parrot sounds
    stopSound(parrotIdleSound);
    stopSound(parrotFlySound);
    stopSound(parrotDangerSound);
    stopSound(parrotEscapeSound);
}

function resumeAllAmbientSounds(){

    if (musicOn) bgMusic.play().catch(()=>{});

    // resume ONLY the current vehicle sound
    if (currentVehicle && currentVehicle._sound) {
        currentVehicle._sound.currentTime = 0;
        currentVehicle._sound.play().catch(()=>{});
    }
}



const drawCardSound = new Audio("sounds/draw_card.mp3");
/* =========================
   SOUND EFFECTS (SFX)
========================= */

const SFX = {
    draw:            new Audio("sounds/draw_card.mp3"),

    parkCard:        new Audio("sounds/park_coin.mp3"),
    parkResult:      new Audio("sounds/result.mp3"),

    farmSpin:        new Audio("sounds/spinthewheel.mp3"),
    farmResult:      new Audio("sounds/result.mp3"),


    mallFlip:        new Audio("sounds/calender_flip.mp3"),
    mallResult:      new Audio("sounds/result.mp3"),

    casinoLever:     new Audio("sounds/casino_jackpot.mp3"),
    casinoWin:       new Audio("sounds/casino_win.mp3"),
    casinoLose:      new Audio("sounds/casino_lose.mp3"),
};



/* =========================
   FARM REGION MUSIC
========================= */

const farmMusic = {
    Terai: new Audio("sounds/terai_click.mp3"),
    Hills: new Audio("sounds/hilly_click.mp3"),
    Himalayas: new Audio("sounds/himalayan_click.mp3"),
};

let currentFarmMusic = null;

function playFarmMusic(region){
    if (!audioUnlocked || !musicOn) return;

    if (currentFarmMusic) {
        currentFarmMusic.pause();
        currentFarmMusic.currentTime = 0;
    }

    const m = farmMusic[region];
    if (!m) return;

    m.loop = false;
    m.volume = 0.5;
    m.play().catch(()=>{});
    currentFarmMusic = m;
}

function stopFarmMusic(){
    if (currentFarmMusic) {
        currentFarmMusic.pause();
        currentFarmMusic.currentTime = 0;
        currentFarmMusic = null;
    }
}


let currentRegionSound = null;

function playSFX(key, volume = 0.6) {
    if (!audioUnlocked || !musicOn) return;

    const s = SFX[key];
    if (!s) return;

    s.pause();
    s.currentTime = 0;
    s.volume = volume;
    s.play().catch(()=>{});
}





function showHelp() {
    openPopup(
        "Game Help",
"‚Ä¢  Each player should receive <b>2.5 million</b> at the start of the game."+
"<br>3 √ó 500K, 6 √ó 100K, 4 √ó 50K, 6 √ó 20K, 5 √ó 10K, 5 √ó 5K, 5 √ó 1K" +

"<br><br>‚Ä¢  When you are assigned to go to property by any of the drawn cards - You do not collect G√• bonus."+

"<br><br>‚Ä¢  If you get radio in the dice, click the radio button. Your next dice number specifies what you need to do."+

"<br><br>‚Ä¢  During auction, you can give multiple bid till you get the winner."







,
        "popup-community tinted"
    );
}



function shuffleArray(arr) {
    return arr.sort(() => Math.random() - 0.5);
}


/// üéµ BACKGROUND MUSIC SYSTEM
const bgMusic = document.getElementById("bgMusic");

// Pick random starting track 1‚Äì5
const musicIndex = Math.floor(Math.random() * 2) + 1;
bgMusic.src = `sounds/bg_monopoly${musicIndex}.mp3`;
bgMusic.volume = 0.75;  



let musicOn = true;

// Browser requires user action before audio can play
document.addEventListener("click", function startMusicOnce() {
    if (musicOn) bgMusic.play().catch(()=>{});
    document.removeEventListener("click", startMusicOnce);
});

// üîÅ Play next random track when one ends
bgMusic.onended = function () {
    const nextIndex = Math.floor(Math.random() * 2) + 1;
    bgMusic.src = `sounds/bg_monopoly${nextIndex}.mp3`;
    if (musicOn) bgMusic.play().catch(()=>{});
};

// üîä Toggle button
function toggleSound() {
    const btn = document.getElementById("soundToggle");

    if (musicOn) {
        bgMusic.pause();
        btn.textContent = "üîà";  // muted icon
        musicOn = false;
    } else {
        bgMusic.play().catch(()=>{});
        btn.textContent = "üîä";  // sound on icon
        musicOn = true;
    }
}



function rollWelcomeDice() {
    const cubes = document.querySelectorAll("#welcomeCard .cube");

    cubes.forEach(cube => {
        const xRand = 360 * (1 + Math.floor(Math.random() * 3));
        const yRand = 360 * (1 + Math.floor(Math.random() * 3));
        const xFace = [0, 90, -90][Math.floor(Math.random() * 3)];
        const yFace = [0, 90, -90, 180][Math.floor(Math.random() * 4)];

        cube.style.transition = "transform 1.3s cubic-bezier(.36,.07,.19,.97)";
        cube.style.transform = `
            rotateX(${xRand + xFace}deg)
            rotateY(${yRand + yFace}deg)
        `;
    });
}


// Auto roll every 3 seconds
setInterval(rollWelcomeDice, 3000);

// First roll immediately
setTimeout(rollWelcomeDice, 500);



/* ===========================
   logging cards
   =========================== */


function addGroupedLog(category, title, action, colorClass = "") {
    const time = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

    let target = null;

    if (category === "Community")        target = document.getElementById("logCommunity");
else if (category === "Chance")     target = document.getElementById("logChance");
else if (category === "Radio")      target = document.getElementById("logRadio");
else if (category === "Restaurant") target = document.getElementById("logRestaurant");
else if (category === "Park")       target = document.getElementById("logPark");
else if (category === "Casino")     target = document.getElementById("logCasino");
else if (category === "Farm")       target = document.getElementById("logFarm");
else if (category === "Shopping Mall") target = document.getElementById("logShoppingMall");


    if (!target) return;

    const entry = document.createElement("li");
    entry.innerHTML = `<strong>${time}</strong> ‚Äî ${title}<br><small>${action}</small>`;

    // üé® RADIO COLOR SUPPORT
    if (colorClass.includes("radio-border-red"))    entry.style.color = "var(--red-color)";
    else if (colorClass.includes("radio-border-green"))  entry.style.color = "var(--green-color)";
    else if (colorClass.includes("radio-border-purple")) entry.style.color = "var(--purple-color)";
    else if (colorClass.includes("radio-border-blue"))   entry.style.color = "var(--lightblue-color)";
    else if (colorClass.includes("radio-border-yellow")) entry.style.color = "var(--yellow-color)";

    target.prepend(entry);
}




/* ===========================
   POPUP CREATOR
   =========================== */
function openPopup(title, action, colorClass = "") {
pauseAllAmbientSounds();


    drawCardSound.currentTime = 0;
    drawCardSound.play().catch(()=>{});

    const overlay = document.createElement("div");
    overlay.className = "modal-overlay";

    const modal = document.createElement("div");
    modal.className = "modal tinted " + colorClass;

    if (colorClass.includes("radio-border-")) {
        const key = colorClass.split("radio-border-")[1].split(" ")[0];
        const cssColor = getComputedStyle(document.documentElement)
            .getPropertyValue(`--${key}-color`);
        modal.style.setProperty("--tint", cssColor);
    }


// Determine log category
let category = "Card";

if (colorClass.includes("popup-community"))      category = "Community";
else if (colorClass.includes("popup-chance"))    category = "Chance";
else if (colorClass.includes("popup-restaurant"))category = "Restaurant";
else if (colorClass.includes("popup-casino"))    category = "Casino";
else if (colorClass.includes("popup-park"))      category = "Park";
else if (colorClass.includes("popup-farm"))      category = "Farm";
else if (colorClass.includes("popup-mall"))      category = "Shopping Mall";


// Log radio property or any other second overlay card
addGroupedLog(category, title, action, colorClass);






    modal.innerHTML = `
        <div class="close-btn"
            onclick="
                this.closest('.modal-overlay').remove();
resumeAllAmbientSounds();


                // stop radio sounds
                radioEffectSound?.pause();
                radioPropertySound?.pause();

                // resume background music
                if (musicOn) bgMusic.play().catch(()=>{});

                // resume only active vehicle audio
                radioMode = false;
                document.querySelectorAll('.vehicle').forEach(v => {
                    if (v.style.opacity == '1' && v._sound) {
                        v._sound.play().catch(()=>{});
                    } else if (v._sound) {
                        v._sound.pause();
                        v._sound.currentTime = 0;
                    }
                });
            ">
            ‚úñ
        </div>

        <h2>${title}</h2>
        <p>${action}</p>
    `;

    overlay.appendChild(modal);
    document.body.appendChild(overlay);
}









function spawnMoneyDrop() {
    const container = document.querySelector("#welcomeCard .money-rain");
    if (!container) return;

    const bill = document.createElement("img");

    const moneyTypes = [
        "media/money1.png",
        "media/money2.png",
        "media/money3.png",
"media/money4.png",
        "media/money5.png",
        "media/money6.png",
"media/money7.png",
        "media/money8.png",
        "media/money9.png",
"media/money10.png"

    ];
    bill.src = moneyTypes[Math.floor(Math.random() * moneyTypes.length)];
    bill.classList.add("money-drop");

    // ‚≠ê RANDOM SIZE (3vh ‚Üí 8vh)
    const sizeValue = Math.random() * 5 + 3;   // Number only (not string)
    bill.style.width = sizeValue + "vh";

    // ‚≠ê SPEED BASED ON SIZE
    // Big bills = faster, small bills = slower
    const speed = 20 - sizeValue * 1.2;  // tweak multiplier as needed
    bill.style.animationDuration = speed.toFixed(2) + "s";

    // RANDOM START POSITION
    bill.style.left = Math.random() * 90 + "%";

    // RANDOM ROTATION
    const rotation = Math.random() * 40 - 20;
    bill.style.transform = `rotate(${rotation}deg)`;

    container.appendChild(bill);

    // REMOVE AFTER animation
    setTimeout(() => bill.remove(), speed * 1000);
}


// continuous rain
setInterval(spawnMoneyDrop, 1000);






function openPopupInsideSameOverlay(title, action, colorClass = "") {

    const overlay = document.querySelector(".modal-overlay:last-of-type");

    const modal = document.createElement("div");
    modal.className = "modal tinted " + (colorClass || "");

// Determine log category (same logic as openPopup)
let category = "Card";

if (colorClass.includes("popup-community"))       category = "Community";
else if (colorClass.includes("popup-chance"))     category = "Chance";
else if (colorClass.includes("radio-border-"))    category = "Radio";
else if (colorClass.includes("popup-restaurant")) category = "Restaurant";
else if (colorClass.includes("popup-pier"))       category = "Pier";
else if (colorClass.includes("popup-garden") ||
         colorClass.includes("popup-park"))       category = "Park";
else if (colorClass.includes("popup-casino"))     category = "Casino";

// Log radio property or any other second overlay card
addGroupedLog(category, title, action, colorClass);




    // set tint dynamically
    if (colorClass.includes("radio-border-")) {
        const key = colorClass.split("radio-border-")[1].split(" ")[0];
        const cssColor = getComputedStyle(document.documentElement)
            .getPropertyValue(`--${key}-color`);
        modal.style.setProperty("--tint", cssColor);
    }

    modal.innerHTML = `
        <div class="close-btn"
            onclick="
                this.closest('.modal-overlay').remove();
resumeAllAmbientSounds();


                // stop radio sounds
                radioEffectSound?.pause();
                radioPropertySound?.pause();

                // resume background music
                if (musicOn) bgMusic.play().catch(()=>{});

                // resume only the currently active vehicle sound
                radioMode = false;
                document.querySelectorAll('.vehicle').forEach(v => {
                    if (v.style.opacity == '1' && v._sound) {
                        v._sound.play().catch(()=>{});
                    } else if (v._sound) {
                        v._sound.pause();
                        v._sound.currentTime = 0;
                    }
                });
            ">
            ‚úñ
        </div>

        <h2>${title}</h2>
        <p>${action}</p>
    `;

    overlay.appendChild(modal);
}





/* -------------------------------------------------------
   FULL CHANCE CARDS
-------------------------------------------------------- */
const chanceCards = [
  { title:"Ghandruk Trek", action:"Advance to Ghandruk." },
  { title:"Landslide Ahead", action:"Road blocked by landslide. Move back 3 spaces." },
  { title:"Lucky Taxi Share", action:"A tourist shares a taxi with you. Advance to any high-value property worth more than Rs 2.5 Lakh." },
  { title:"Load Shedding", action:"Power cut disrupts plans. Miss one turn." },
  { title:"Bhatbhateni Lucky Draw", action:"You win a lucky draw. Collect Rs 50 K." },
  { title:"Melamchi Repair Fund", action:"Pay Rs 40 K to support water supply repairs." },
  { title:"Foreign Remittance", action:"You receive money from abroad. Collect Rs 60 K." },
  { title:"Monsoon Flood", action:"Flood damages houses. Pay Rs 50 K per house you own." },
  { title:"Helicopter Rescue Coupon", action:"Use this coupon to ignore your next rent payment." },
  { title:"Advance to New Road", action:"Move directly to New Road." },
  { title:"Bluebook Fine", action:"You forgot to renew your vehicle bluebook. Pay Rs 30 K." },
  { title:"Dashain Tika Blessing", action:"Festive blessings! Collect Rs 50 K from every player." },
  { title:"Maghe Sankranti Feast", action:"Family feast celebration. Collect Rs 60 K." },
  { title:"Lhosar Celebration", action:"Festival joy lifts you forward. Move ahead 4 spaces." },
  { title:"Mah Puja Blessing", action:"You receive divine blessings. Build one special upgrade on a property for free." },
  { title:"Bhailo Collection", action:"Bhailo group visits your properties. Pay Rs 30 K per property." },
  { title:"Cricket Bet Win", action:"Your cricket prediction comes true. Collect Rs 1 Lakh." },
  { title:"Road Expansion Project", action:"Government acquires your land. Collect Rs 3 Lakh." },
  { title:"Maitighar Traffic Jam", action:"Severe traffic jam delays you. Move back to the nearest corner." },
  { title:"Bandha Declared", action:"Nationwide bandha. You do not pay rent until your next turn." },
  { title:"Helping a Tourist", action:"You help a lost tourist. Collect Rs 50 K." },
  { title:"Kal Bhairav‚Äôs Blessing", action:"Spiritual energy flows. Roll the dice again." },
  { title:"Sherpa Guide Shortcut", action:"A Sherpa shows you a shortcut. Advance to any high-value property worth more than Rs 2.5 Lakh." },
  { title:"Tharu Cultural Night", action:"You enjoy a cultural program. Pay Rs 30 K." },
  { title:"Chiya Accident", action:"Your friend spills chiya on you. Pay Rs 30 K for dry cleaning." },
  { title:"New Year Lottery", action:"Luck smiles on you. Collect Rs 1.5 Lakh." },
  { title:"Tourism Boom", action:"Jay Nepal! Tourism rises. All players pay you Rs 50 K." },
  { title:"Yomari Craving", action:"Sweet cravings strike. Advance to the nearest Restaurant if available." },
  { title:"Dashain Khasi Escapes", action:"Festival chaos! Pay Rs 50 K." },
  { title:"Bus Stop Confusion", action:"You miss your stop. Move to Taxi Rental." },
  { title:"Tractor Hay Block", action:"Road blocked by tractor. Move back 1 space." },
  { title:"Holi Bhang Incident", action:"Too much celebration. Miss one turn." },
  { title:"Everest Sunrise View", action:"Breathtaking view! Move to Namche Bazaar." },
  { title:"Forgot to Bargain", action:"You overpay at the market. Pay Rs 30 K." },
  { title:"Slip on Tarul", action:"You slip during feast. Move back 2 spaces." },
  { title:"Indra Jatra Blessing", action:"Chariot blessing received. Take any unowned property." },
  { title:"Hidden Trail", action:"A secret path opens. Advance 5 spaces." },
  { title:"Rara Lake Trek", action:"Adventure begins. Advance to Rara." },
  { title:"Yak Ride Experience", action:"Mountain fun costs money. Pay Rs 40 K." },
  { title:"Momo Eating Contest", action:"You win the contest! Collect Rs 1.2 Lakh." },
  { title:"Tamang Lhosar", action:"Festival cheer pushes you ahead. Move forward 3 spaces." },
  { title:"Lakhey Dance", action:"Street performance leads you onward. Move to New Road." },
  { title:"Manakamana Blessing", action:"Faith rewarded. Roll again." },
  { title:"Bus Breakdown", action:"Vehicle trouble delays you. Miss one turn." },
  { title:"TikTok Viral", action:"Your video goes viral. Collect Rs 75 K." },
  { title:"Wedding Procession Expense", action:"Lavish wedding costs hit. Pay Rs 2 Lakh." },
  { title:"Land Value Surge", action:"Property prices rise sharply. Collect Rs 2.5 Lakh." },
  { title:"Heavy Snowfall", action:"Snow blocks the route. Move back 4 spaces." },
  { title:"Tongba Souvenir", action:"You buy Tongba as a souvenir. Pay Rs 40 K." },
  { title:"Khukuri Award", action:"You receive an honor. Collect Rs 50 K." },
  { title:"Animal Rescue", action:"Rescue mission redirects you. Move to nearest Transport utility." },
  { title:"Kalanki Traffic", action:"Gridlock frustration. Miss one turn." },
  { title:"Wrong Tourist Direction", action:"You misguide a tourist. Go directly to Jail." },
  { title:"Street Dogs Chase", action:"You run fast! Move forward 10 spaces." },
  { title:"Tempo Accident", action:"Minor injury from a fall. Pay Rs 40 K." },
  { title:"Kite Thread Cut", action:"Sharp thread injures you. Pay Rs 30 K." },
  { title:"Holi Prank Success", action:"Your prank works. Collect Rs 40 K." }
];


/* -------------------------------------------------------
   FULL COMMUNITY CARDS
-------------------------------------------------------- */
const communityCards = [
  { title:"Community Forest Work", action:"You volunteer at the community forest. Collect Rs 60 K." },
  { title:"School Fees", action:"You pay school fees for a child. Pay Rs 50 K." },
  { title:"Municipality Scholarship", action:"You receive a municipal scholarship. Collect Rs 1.5 Lakh." },
  { title:"Health Post Visit", action:"You visit the local health post. Pay Rs 40 K." },
  { title:"Gaijatra Winner", action:"Your goat wins recognition during Gaijatra. Collect Rs 70 K." },
  { title:"Earthquake Home Repair", action:"You repair earthquake damage to your home. Pay Rs 1.25 Lakh." },
  { title:"Ward Chairperson", action:"You are elected ward chairperson. Collect Rs 1 Lakh." },
  { title:"Bridge Construction Donation", action:"You donate for bridge construction. Pay Rs 75 K." },
  { title:"Medical Emergency", action:"Unexpected medical costs arise. Pay Rs 1 Lakh." },
  { title:"Farmers‚Äô Market Sale", action:"You sell produce at the farmers‚Äô market. Collect Rs 60 K." },
  { title:"Deusi Bhailo Tips", action:"Festive Deusi Bhailo tips received. Collect Rs 90 K." },
  { title:"Doko Weaving Champion", action:"You win a Doko weaving competition. Collect Rs 80 K." },
  { title:"Temple Cleaning", action:"You help clean a local temple. Collect Rs 50 K." },
  { title:"School Meal Donation", action:"You donate for school meals. Pay Rs 50 K." },
  { title:"Storm Relief Aid", action:"You receive storm relief assistance. Collect Rs 1 Lakh." },
  { title:"Juju Dhau Festival", action:"You spend at the Juju Dhau festival. Pay Rs 40 K." },
  { title:"Yomari Punhi Sale", action:"Your Yomari sells well during Punhi. Collect Rs 80 K." },
  { title:"Community Honor", action:"You are honored by the community. Collect Rs 1 Lakh." },
  { title:"Rebuild Storage Shed", action:"You rebuild a damaged shed. Pay Rs 60 K." },
  { title:"Local Mela Earnings", action:"You earn money at a local mela. Collect Rs 90 K." },
  { title:"Dhunge Dhara Repair", action:"You help repair the stone water tap. Pay Rs 60 K." },
  { title:"Janakpur Pilgrimage", action:"You go on a pilgrimage. Move to Janakpur." },
  { title:"Lakeside Sky Activity", action:"You try an adventure activity. Move to Lakeside." },
  { title:"Cooperative Dividend", action:"Your cooperative pays dividends. Collect Rs 1.5 Lakh." },
  { title:"Grain Grinding Work", action:"You help villagers grind grain. Collect Rs 50 K." },
  { title:"Burned Sel Roti", action:"You burn sel roti while cooking. Pay Rs 40 K." },
  { title:"Millet Plantation", action:"Your millet plantation succeeds. Take another turn." },
  { title:"Lost Slippers in Shrawan", action:"You lose your slippers in the rain. Pay Rs 10 K." },
  { title:"Jhingati Roof Repair", action:"You fix a jhingati roof. Pay Rs 70 K." },
  { title:"Tika Jamara Gift", action:"You receive tika and jamara. Collect Rs 80 K." },
  { title:"Foreign Return", action:"Your friends ask for a gift. Pay Rs 50 K to each player." },
  { title:"Friends Demand Treat", action:"Your friends ask for a treat. Pay Rs 50 K to each player." },
  { title:"No-Smoking Campaign", action:"You support a no-smoking campaign. Collect Rs 60 K." },
  { title:"Foreign Remittance", action:"You receive remittance from abroad. Collect Rs 2 Lakh." },
  { title:"Family Function", action:"You host a family event. Pay Rs 70 K." },
  { title:"Marriage Photography", action:"You pay for wedding photography. Pay Rs 1 Lakh." },
  { title:"Marriage Catering Discount", action:"You get a catering discount. Collect Rs 60 K." },
  { title:"Dhaba Break", action:"You relax at a roadside dhaba. Pay Rs 40 K." },
  { title:"Deusi Bhailo Collection", action:"You collect Rs 50 K Deusi-Bhailo from each player." },
  { title:"Mamaghar Gifts", action:"You receive gifts from mamaghar. Collect Rs 1 Lakh." },
  { title:"Kukur Puja Rituals", action:"Rent a dog to perform Kukur Puja rituals. Pay Rs 20 K." },
  { title:"Ghee and Tarul Purchase", action:"You buy ghee and tarul. Pay Rs 50 K." },
  { title:"Achar Business", action:"Your achar business does well. Collect Rs 90 K." },
  { title:"Community Cleaning", action:"You join a community cleaning drive. Collect Rs 50 K." },
  { title:"Sel Roti Tasting", action:"You sell sel roti samples. Collect Rs 40 K." },
  { title:"Sports Day Sponsorship", action:"You sponsor a school sports day. Pay Rs 60 K." },
  { title:"Elders‚Äô Blessing", action:"You receive tika and blessings. Collect Rs 70 K." },
  { title:"Local Mela Visit", action:"You spend at a local mela. Pay Rs 40 K." },
  { title:"Flood Rice Donation", action:"You donate rice for flood victims. Pay Rs 60 K." }
];


/* -------------------------------------------------------
   ENTERPRISE OUTCOMES
-------------------------------------------------------- */
const restaurantOutcomes = [
    { title: "Busy Dinner Rush", action: "Pay owner 80 K." },
    { title: "Quiet Evening", action: "Pay owner 30 K." },
    { title: "Celebrity Chef Event", action: "Pay owner 120 K." },
    { title: "Bad Reviews", action: "Owner pays you 20 K." },
    { title: "Perfect Location", action: "If neighbors upgraded: pay owner 150 K." },
    { title: "Happy Hour", action: "Pay owner 60 K." },
    { title: "Food Critic Review", action: "Owner pays 100 K penalty." },
    { title: "Slow Tourist Day", action: "Pay owner 25 K." },
    { title: "Banquet Booking", action: "Pay owner 140 K." },
    { title: "Kitchen Repairs", action: "Pay owner 40 K." },
    { title: "Seafood Night", action: "Pay owner 90 K." },
    { title: "Overcrowded Tables", action: "Pay owner 110 K." },
    { title: "Neighborhood Boost", action: "If neighbor upgraded: pay owner 70 K." },
    { title: "Chef Sick", action: "Owner pays 10 K." },
    { title: "Tour Group Arrival", action: "Pay owner 130 K." }
];


const gardenOutcomes = [
];

const casinoOutcomes = [
    
];





/* ===========================
   RADIO SYSTEM ‚Äî PROPERTY COLORS
   =========================== */

// PLACE COLORS
const propertyColors = {
  "Ghandruk, Kaski": "brown",
  "Sinja Valley, Jumla": "brown",

  "Gosainkunda, Rasuwa": "lightblue",
  "Swargadwari, Pyuthan": "lightblue",
  "Api-Saipal Region, Darchula": "lightblue",

  "Chisapani, Kalikot": "pink",
  "Tansen, Palpa": "pink",
  "Bardibas, Mahottari": "pink",

  "Tulsipur, Dang": "orange",
  "Janakpur, Dhanusha": "orange",
  "Rara Region, Mugu": "orange",

  "Illam Bazaar, Illam": "red",
  "Jomsom, Mustang": "red",
  "Mahendranagar, Kanchanpur": "red",

  "Namchebazaar, Solukhumbu": "yellow",
  "Ghantaghar, Dharan": "yellow",
  "Birjung, Parsa": "yellow",

  "Nepaljung, Banke": "green",
  "Lakeside, Pokhara": "green",
  "Mainroad, Biratnagar": "green",

  "Jhamsikhel, Lalitpur": "purple",
  "New Road, Kathmandu": "purple",



/* TRANSPORT (Black) */
    "Scooter Rental": "transport",
    "Taxi Rental": "transport",
    "Sumo Rental": "transport",
    "Bicycle Rental": "transport",

    /* STATE UTILITIES (Grey) */
    "Nepal Telecom": "state",
    "Nepal Electricity Authority": "state",
    "Nepal Khanepani Sansthan": "state"


};




let chancePlaylist = shuffleArray([...chanceCards]);
let communityPlaylist = shuffleArray([...communityCards]);
let restaurantPlaylist = shuffleArray([...restaurantOutcomes]);
let gardenPlaylist = shuffleArray([...gardenOutcomes]);









// Build the list used for random draw
const radioProperties = Object.keys(propertyColors);


/* ===========================
   RADIO DICE CARD CONTENT
   =========================== */

const radioDiceInfo = {
    title: "üìª RADIO ‚Äì Dice Effects",
    action:
        "1 ‚Äì You may buy the property if unowned (Pay rent if owned).<br>" +
        "2 ‚Äì Tourist Spotlight - Pay the rent (2x rent if development exist).<br>" +
        "3 ‚Äì Storm Warning (owner pays 30 K to Bank for maintenance).<br>" +
        "4 ‚Äì Festival Event (Pay upgrade 20% of property cost to owner).<br>" +
        "5 ‚Äì Inspection (Owner pays you 20K).<br>" +
        "6 ‚Äì Jackpot! - Get the property as a reward. If owned then pay no rent."
};


/* ===========================
   GENERIC CARD DRAW
   =========================== */
function drawGeneric(list, styleClass) {
    if (!list.length) {
        openPopup("No Cards", "This list is empty.", styleClass);
        return;
    }

    const card = list[Math.floor(Math.random() * list.length)];
    openPopup(card.title, card.action, styleClass);
}





/* ===========================
   RADIO ‚Äî TWO POPUPS
   =========================== */
let radioVoicePlaylist = shuffleArray([...radioProperties]);
let radioEffectSound = null;
let radioMode = false;   // vehicles muted while radio is active
let radioPropertySound = null;



function drawRadio() {

    // Pause background music for voice clarity
    bgMusic.pause();

radioMode = true;

// pause all active vehicle sounds
document.querySelectorAll(".vehicle").forEach(v => {
    if (v._sound) v._sound.pause();
});


    // If we‚Äôve used all properties, reshuffle for a new cycle
    if (radioVoicePlaylist.length === 0) {
        radioVoicePlaylist = shuffleArray([...radioProperties]);
    }

    // Take next property from playlist
    const property = radioVoicePlaylist.shift();

    // First popup: Dice card
    openPopup(
        radioDiceInfo.title, 
        radioDiceInfo.action, 
        "popup-radio popup-radio-dice"
    );

    // Property popup
    const colorClass =
        "radio-border-" + propertyColors[property] + " tinted";

    openPopupInsideSameOverlay(
        property,
        "",
        colorClass
    );

    // Normalize property name for audio filename
const normalized = property
    .toLowerCase()
    .replace(/√∂/g, "o")
    .replace(/√§/g, "a")
    .replace(/√•/g, "a")
    .replace(/[^a-z0-9]+/g, "_");

const audioFile = `sounds/radio_${normalized}.mp3`;

// --- NEW RADIO SEQUENCE ---
// 1. Play random radio effect first
const randomEffectIndex = Math.floor(Math.random() * 3) + 1;
radioEffectSound = new Audio(`sounds/radio (${randomEffectIndex}).mp3`);
radioEffectSound.play().catch(()=>{});

// 2. When effect finishes ‚Üí play property
radioEffectSound.onended = () => {
    radioPropertySound = new Audio(audioFile);

// 3. When property finishes ‚Üí play radio_end
    radioPropertySound.onended = () => {
        const radioEndSound = new Audio("sounds/radio_end.mp3");
        radioEndSound.play().catch(()=>{});
    };

    radioPropertySound.play().catch(()=>{});
};







}






/* ===========================
   BUTTON HANDLERS
   =========================== */

/* ===========================
   NON-REPEATING DRAW FUNCTIONS
   =========================== */

// CHANCE
function drawChance() {
    if (chancePlaylist.length === 0) {
        chancePlaylist = shuffleArray([...chanceCards]);
    }
    const card = chancePlaylist.shift();
    openPopup(card.title, card.action, "popup-chance tinted");
}

// COMMUNITY
function drawCommunity() {
    if (communityPlaylist.length === 0) {
        communityPlaylist = shuffleArray([...communityCards]);
    }
    const card = communityPlaylist.shift();
    openPopup(card.title, card.action, "popup-community tinted");
}

// RESTAURANT
function drawRestaurant() {
    if (restaurantPlaylist.length === 0) {
        restaurantPlaylist = shuffleArray([...restaurantOutcomes]);
    }
    const card = restaurantPlaylist.shift();
    openPopup(card.title, card.action, "popup-restaurant tinted");
}


// GARDEN
function drawGarden() {
    if (gardenPlaylist.length === 0) {
        gardenPlaylist = shuffleArray([...gardenOutcomes]);
    }
    const card = gardenPlaylist.shift();
    openPopup(card.title, card.action, "popup-garden tinted");
}



function drawParkMultiplier(){
pauseAllAmbientSounds();


    const screen = document.getElementById("parkScreen");
    const content = document.getElementById("parkContent");

    screen.style.display = "flex";

    content.innerHTML = `
    <div class="park-card-container">

      <div class="park-card" id="pTime">
        <div class="park-banner">TIME</div>
        <div class="park-emoji" id="pTimeEmoji">‚è≥</div>
        <div class="park-label" id="pTimeText">‚Äî</div>
        <div class="park-stars" id="pTimeStars"></div>
      </div>

      <div class="park-mini" id="pMul">√ó</div>

      <div class="park-card" id="pWeather">
        <div class="park-banner">WEATHER</div>
        <div class="park-emoji" id="pWeatherEmoji">‚òÅÔ∏è</div>
        <div class="park-label" id="pWeatherText">‚Äî</div>
        <div class="park-stars" id="pWeatherStars"></div>
      </div>

      <div class="park-mini" id="pEq">=</div>

      <div class="park-card" id="pFinal">
        <div class="park-banner">STARS</div>

        <div class="park-star-body">
            <div class="park-star-grid" id="pFinalStars"></div>
        </div>

        <div class="park-stars-footer"></div>
      </div>

    </div>

    <!-- üîò ACTION BUTTONS -->
    <div class="park-controls">
        <button class="park-action-btn" onclick="runParkAnimation()">Draw</button>
        <button class="park-action-btn reset" onclick="resetParkAnimation()">Reset</button>
    </div>
`;


    
}





function runParkAnimation(){

    // 1Ô∏è‚É£ RESET VISUAL STATE
    [pTime, pMul, pWeather, pEq, pFinal].forEach(el => {
        el.classList.remove("park-show");
        el.style.opacity = 0;
        el.style.transform = "scale(0.5)";
    });

    // Clear previous content
    pTimeStars.innerHTML = "";
    pWeatherStars.innerHTML = "";
    pFinalStars.innerHTML = "";

    // Reset placeholders
    pTimeEmoji.textContent = "‚è≥";
    pTimeText.textContent = "‚Äî";
    pWeatherEmoji.textContent = "‚òÅÔ∏è";
    pWeatherText.textContent = "‚Äî";

    // 2Ô∏è‚É£ WAIT FOR NEXT FRAME (THIS IS THE KEY)
    requestAnimationFrame(() => {

        // 3Ô∏è‚É£ NOW DO LOGIC + CONTENT UPDATE

        const times = ["Morning","Day","Evening"];
        const weather = ["Sunny","Cloudy","Rainy"];

        const timeStars = {Morning:1,Day:2,Evening:3};
        const weatherStars = {Sunny:2,Cloudy:1,Rainy:1};

        const timeEmoji = {Morning:"üåÖ",Day:"üåû",Evening:"üåá"};
        const weatherEmoji = {Sunny:"‚òÄÔ∏è",Cloudy:"‚òÅÔ∏è",Rainy:"üåßÔ∏è"};

        const t = times[Math.floor(Math.random()*times.length)];
        const w = weather[Math.floor(Math.random()*weather.length)];
        const stars = timeStars[t] * weatherStars[w];

        // TIME
        pTimeEmoji.textContent = timeEmoji[t];
        pTimeText.textContent = t;
        pTimeStars.innerHTML = "‚≠ê".repeat(timeStars[t]);

        // WEATHER
        pWeatherEmoji.textContent = weatherEmoji[w];
        pWeatherText.textContent = w;
        if (weatherStars[w] > 0) {
            pWeatherStars.innerHTML = "‚≠ê".repeat(weatherStars[w]);
        }

        // FINAL STARS (2 per row)
        for (let i = 0; i < stars; i++) {
            pFinalStars.innerHTML += "<div>‚≠ê</div>";
        }

        // 4Ô∏è‚É£ SEQUENTIAL ANIMATION (ALWAYS REPLAYS)
        setTimeout(()=>{
    pTime.classList.add("park-show");
    playSFX("parkCard", 0.6);
},100);

        setTimeout(()=>pMul.classList.add("park-show"),450);
setTimeout(()=>{
    pWeather.classList.add("park-show");
    playSFX("parkCard", 0.6);
},800);

        setTimeout(()=>pEq.classList.add("park-show"),1150);
setTimeout(()=>{
    pFinal.classList.add("park-show");
    playSFX("parkResult", 0.8);
},1500);


        addGroupedLog(
            "Park",
            `${t} √ó ${w} = ${stars} ‚≠ê`,
            ""
        );

    });
}



function closeParkScreen(){
    document.getElementById("parkScreen").style.display = "none";
    document.getElementById("parkContent").innerHTML = "";
resumeAllAmbientSounds();

}


function openShoppingMall(){
pauseAllAmbientSounds();


    const screen = document.getElementById("mallScreen");
    const content = document.getElementById("mallContent");

    screen.style.display = "flex";
    document.body.style.overflow = "hidden";

    content.innerHTML = `
    <div
        id="pickMonthBanner"
        onclick="playSFX('mallFlip'); startFlip()"

        style="cursor:pointer;"
    >
        Pick a Month
    </div>

    <div class="calendar">
        <div class="page" id="page"></div>
    </div>

    <div id="incomeBanner">Expenses ‚òÖ‚òÖ‚òÖ</div>
    <div id="infoBox"></div>
`;


    renderMonth("Baisakh");
}

function closeShoppingMall(){
    document.getElementById("mallScreen").style.display = "none";
    document.getElementById("mallContent").innerHTML = "";
    document.body.style.overflow = "";
resumeAllAmbientSounds();

}

function openFarm(){
pauseAllAmbientSounds();
playFarmMusic(currentRegion);


    const screen = document.getElementById("farmScreen");
    const content = document.getElementById("farmContent");

    screen.style.display = "flex";
    document.body.style.overflow = "hidden";

    content.innerHTML = `
<div class="wrap">

  <div class="selector">
    <div class="rbtn terai" data-region="Terai">Terai</div>
    <div class="rbtn hills" data-region="Hills">Hills</div>
    <div class="rbtn himal" data-region="Himalayas">Himalayas</div>
  </div>

  <section class="panel stage">
    <div class="pointer"></div>
    <div class="pointer-base"></div>
    <div class="wheel" id="wheel"></div>
    <div class="hub" id="hub">SPIN</div>
  </section>

  <div class="result-card" id="farmResultCard" style="display:none;">
    <div class="banner" id="banner"></div>
    <div class="resline" id="line2"></div>
</div>


</div>
`;


document.getElementById("farmScreen").style.background =
    farmBackgrounds[currentRegion];
const resultCard = document.getElementById("farmResultCard");
if (resultCard) resultCard.style.display = "none";


    initFarm();
}

function closeFarm(){

    // üîä STOP FARM REGION MUSIC FIRST
    stopFarmMusic();

    // hide farm screen
    document.getElementById("farmScreen").style.display = "none";
    document.getElementById("farmContent").innerHTML = "";
    document.body.style.overflow = "";

    // üîä resume background & vehicle sounds
    resumeAllAmbientSounds();
}


function openCasino(){
pauseAllAmbientSounds();

    const screen = document.getElementById("casinoScreen");
    const content = document.getElementById("casinoContent");

    screen.style.display = "flex";
    document.body.style.overflow = "hidden";

    content.innerHTML = `
<h1>üé∞ SLOT MACHINE üé∞</h1>

<div class="slot-machine">
    <div class="reels">
        <div class="reel-container"><div class="reel-strip" id="reel1"></div></div>
        <div class="reel-container"><div class="reel-strip" id="reel2"></div></div>
        <div class="reel-container"><div class="reel-strip" id="reel3"></div></div>
    </div>

    <div class="lever-area" onclick="pullLever()">
        <div class="lever-stick"></div>
        <div class="lever-knob"></div>
    </div>
</div>

<div id="result"></div>

<div class="casino-popup-overlay" id="casinoPopup">
    <div class="casino-popup-box" id="casinoPopupBox">
        <div id="casinoPopupMessage">Message</div>
        <button class="casino-popup-button" onclick="closeCasinoPopup()">OK</button>
    </div>
</div>
`;

    loadReels();
}

function closeCasino(){
casinoSpinning = false;

    document.getElementById("casinoScreen").style.display = "none";
    document.getElementById("casinoContent").innerHTML = "";
    document.body.style.overflow = "";
resumeAllAmbientSounds();

}



/* ================= FARM DATA (EXACT COPY) ================= */

/* THEMES */
const themeColors = {
  Terai: ["#00FF99","#66FF66","#CCFF33","#33FFCC","#99FF66","#00E676"],
  Hills: ["#FFA500","#FF7A33","#FFB347","#FFCC66","#FF5E00","#FFD280"],
  Himalayas: ["#00E5FF","#33CCFF","#66FFFF","#99DDFF","#00CCFF","#80F2FF"]
};

const farmBackgrounds = {
  Terai: "radial-gradient(circle at top, #1f7a3f, #0b1020 70%)",
  Hills: "radial-gradient(circle at top, #ff8c00, #0b1020 70%)",
  Himalayas: "radial-gradient(circle at top, #00ccff, #0b1020 70%)"
};



const data = {
  Terai:[
    ["Baisakh","Lasun üßÑ, Pyaj üßÖ, Gahu üåæ, Dal (Musuro, Rahari) ü´ò, Chana üå∞, Tarbuj üçâ",65000],
    ["Jestha","Mong ü´ò, Litchi üçí, Mango ü•≠, Bhindi ü´õ, Tarbuj üçâ",90000],
    ["Ashadh","Mango ü•≠, Litchi üçí, Chaite Dhan üåæ, Mong ü´ò, Parbar ü•í, Karela ü•¨, Pineapple üçç",75000],
    ["Shrawan","Mango ü•≠, Maize üåΩ, Custard Apple üçà, Pineapple üçç, Khursani üå∂Ô∏è",70000],
    ["Bhadra","Mango ü•≠, Maize üåΩ, Khursani üå∂Ô∏è",60000],
    ["Ashwin","Barkhe Dhan üåæ, Bodi ü´ò, Ghiraula ü•í",85000],
    ["Kartik","Aduwa ü´ö, Mula ü•ï, Tomato üçÖ",90000],
    ["Mangsir","Aduwa ü´ö, Mula ü•ï, Tomato üçÖ, Dhan üåæ",80000],
    ["Poush","Tomato üçÖ, Kauli ü•¶, Banda ü•¨",55000],
    ["Magh","Tomato üçÖ, Kauli ü•¶, Banda ü•¨, Besar ü´ö, Tori üåº",60000],
    ["Falgun","Tomato üçÖ, Besar ü´ö, Tori üåº",55000],
    ["Chaitra","Tomato üçÖ, Papaya üçà, Aalas ü´ò, Matar ü´õ",70000]
  ],

  Hills:[
    ["Baisakh","Cucumber ü•í, Cowpea ü´ò, Okra ü´õ, Guava üçê, Peach üçë",35000],
    ["Jestha","Cucumber ü•í, Bitter Gourd ü•í, Pumpkin üéÉ, French Bean ü´ò, Cowpea ü´ò, Okra ü´õ, Potato ü•î, Peach üçë, Plum üçë",45000],
    ["Ashadh","Cauliflower ü•¶, Bitter Gourd ü•í, Pumpkin üéÉ, French Bean ü´ò, Okra ü´õ, Chilli üå∂Ô∏è, Potato ü•î, Pear üçê",40000],
    ["Shrawan","Cauliflower ü•¶, Cabbage ü•¨, Bitter Gourd ü•í, Pumpkin üéÉ, Bell Pepper ü´ë, Okra ü´õ, Chilli üå∂Ô∏è, Pear üçê, Plum üçë",30000],
    ["Bhadra","Cauliflower ü•¶, Cabbage ü•¨, Tomato üçÖ, Cucumber ü•í, Bitter Gourd ü•í, Cowpea ü´ò, Bell Pepper ü´ë, Mustard Greens ü•¨, Okra ü´õ, Radish ü•ï, Chilli üå∂Ô∏è, Guava üçê",65000],
    ["Ashwin","Cauliflower ü•¶, Cabbage ü•¨, Tomato üçÖ, Cucumber ü•í, Bitter Gourd ü•í, Cowpea ü´ò, Bell Pepper ü´ë, Mustard Greens ü•¨, Radish ü•ï, Chilli üå∂Ô∏è, Ginger ü´ö, Apple üçé, Pear üçê",60000],
    ["Kartik","Cauliflower ü•¶, Cabbage ü•¨, Broccoli ü•¶, Tomato üçÖ, Cucumber ü•í, French Bean ü´ò, Green Pea ü´õ, Bell Pepper ü´ë, Mustard Greens ü•¨, Radish ü•ï, Chilli üå∂Ô∏è, Turmeric ü´ö, Ginger ü´ö, Apple üçé, Pomegranate üçé",65000],
    ["Mangsir","Cauliflower ü•¶, Cabbage ü•¨, Broccoli ü•¶, Tomato üçÖ, French Bean ü´ò, Green Pea ü´õ, Mustard Greens ü•¨, Radish ü•ï, Chilli üå∂Ô∏è, Turmeric ü´ö, Ginger ü´ö, Orange üçä, Apple üçé",55000],
    ["Poush","Cauliflower ü•¶, Cabbage ü•¨, Broccoli ü•¶, Tomato üçÖ, Green Pea ü´õ, Radish ü•ï, Orange üçä, Lemon üçã",45000],
    ["Magh","Cauliflower ü•¶, Tomato üçÖ, Green Pea ü´õ, Radish ü•ï, Carrot ü•ï, Potato ü•î, Orange üçä, Lemon üçã",35000],
    ["Falgun","Cauliflower ü•¶, Green Pea ü´õ, Carrot ü•ï, Potato ü•î, Lemon üçã, Guava üçê",40000],
    ["Chaitra","Cucumber ü•í, Green Pea ü´õ, Carrot ü•ï, Guava üçê, Papaya üçà",50000]
  ],

  Himalayas:[
    ["Baisakh","Potato ü•î, Barley üåæ, Buckwheat üåæ, Berries ü´ê, Yak Milk ü•õ, Medicinal Herbs üåø",20000],
    ["Jestha","Buckwheat üåæ, Barley üåæ, Berries ü´ê, Wild Greens ü•¨, Yak Milk ü•õ, Medicinal Herbs üåø",25000],
    ["Ashadh","Early Barley üåæ, Grazing Fodder üå±, Yak Milk ü•õ, Wild Herbs üåø",12000],
    ["Shrawan","High-altitude Medicinal Herbs üåø‚ú®, Yarsagumba üçÑ (Rare), Yak Butter üßà, Chhurpi üßÄ",200000],
    ["Bhadra","Apples üçé, Buckwheat üåæ, Barley üåæ, Yak Milk ü•õ",80000],
    ["Ashwin","Apples üçé Peak, Walnuts üå∞, Yak Butter üßà, Medicinal Herbs üåø",120000],
    ["Kartik","Apple üçé & Walnut üå∞ Peak, Buckwheat üåæ, Chhurpi üßÄ",100000],
    ["Mangsir","Buckwheat üåæ, Barley üåæ, Dried Herbs üåø, Stored Yak Butter üßà",25000],
    ["Poush","Stored Grains üåæ, Dried Herbs üåø, Chhurpi üßÄ",15000],
    ["Magh","Stored Barley üåæ, Buckwheat üåæ, Herbal Tea üåø, Chhurpi üßÄ",15000],
    ["Falgun","Greenhouse Vegetables ü•¨, Early Herbs üåø, Yak Milk ü•õ",30000],
    ["Chaitra","Barley üåæ, Buckwheat üåæ, Berries ü´ê, Medicinal Herbs üåø, Yak Milk ü•õ",40000]
  ]
};



let currentRegion="Terai";
let spinning=false;
let lastActive = null;

function clearGlow(){
  if(lastActive !== null){
    wheel.querySelector(`.sector[data-i="${lastActive}"]`)
      ?.classList.remove("active");
    wheel.querySelector(`.textLabel[data-i="${lastActive}"]`)
      ?.classList.remove("active");
  }
}

function updateFarmRegionButtons(active){
    document.querySelectorAll(".rbtn").forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.region === active);
    });
}


function initFarm(){

    // build wheel for current region
    buildWheel(currentRegion);
updateFarmRegionButtons(currentRegion);


    // set initial background
    document.getElementById("farmScreen").style.background =
        farmBackgrounds[currentRegion];

    // region buttons
    document.querySelectorAll(".rbtn").forEach(btn => {
        btn.onclick = () => {
    currentRegion = btn.dataset.region;
playFarmMusic(currentRegion);


    if (currentRegionSound) {
        currentRegionSound.pause();
        currentRegionSound.currentTime = 0;
    }

    if (currentRegion === "Terai")   currentRegionSound = SFX.teraiClick;
    if (currentRegion === "Hills")   currentRegionSound = SFX.hillsClick;
    if (currentRegion === "Himalayas") currentRegionSound = SFX.himalClick;

    if (currentRegionSound) {
        currentRegionSound.currentTime = 0;
        currentRegionSound.play().catch(()=>{});
    }

    document.getElementById("farmScreen").style.background =
        farmBackgrounds[currentRegion];

    buildWheel(currentRegion);
updateFarmRegionButtons(currentRegion);

};


    });

    // spin button
    document.getElementById("hub").onclick = spinFarm;
}


function rotationForIndex(idx){
  const slice=360/12;
  return 50*360 - (idx*slice) - 15;
}

function buildWheel(region){
  const months = data[region];
  const colors = themeColors[region];
  const slice = 360 / 12;
  const rOuter = 58;

  let sectors = "";
  let texts = "";

  for(let i=0; i<12; i++){
    const m = months[i][0];
    const start = i * slice * Math.PI / 180;
    const end   = (i + 1) * slice * Math.PI / 180;

    const x1 = 60 + rOuter * Math.cos(start);
    const y1 = 60 + rOuter * Math.sin(start);
    const x2 = 60 + rOuter * Math.cos(end);
    const y2 = 60 + rOuter * Math.sin(end);

    const d = `M60,60 L${x1},${y1} A${rOuter},${rOuter} 0 0 1 ${x2},${y2} Z`;

    sectors += `
      <path class="sector"
            data-i="${i}"
            d="${d}"
            fill="${colors[i % colors.length]}" />`;

    texts += `
      <g transform="rotate(${i*slice + slice/2} 60 60)">
        <text class="textLabel"
              data-i="${i}"
              x="${60 + 26}"
              y="60"
              font-size="5"
              dominant-baseline="middle">
          ${m}
        </text>
      </g>`;
  }

  wheel.innerHTML = `
    <svg viewBox="0 0 120 120">
      <g transform="rotate(-90 60 60)">
        ${sectors}
        ${texts}
      </g>
    </svg>`;
}


function spinFarm(){
stopFarmMusic();
if (currentRegionSound) {
    currentRegionSound.pause();
    currentRegionSound.currentTime = 0;
}

playSFX("farmSpin", 0.7);
  if(spinning) return;
  spinning = true;

  clearGlow();

  const idx = Math.floor(Math.random() * 12);
  const rot = rotationForIndex(idx);

  wheel.style.transition = "none";
  wheel.style.transform = "rotate(0deg)";
  void wheel.offsetWidth;

  wheel.style.transition = "transform 5s cubic-bezier(.12,.75,.08,1)";
  wheel.style.transform = `rotate(${rot}deg)`;

  setTimeout(()=>{
    applyFarmResult(idx);
    spinning = false;
  }, 5050);
}


function applyFarmResult(idx){
document.getElementById("farmResultCard").style.display = "block";

  lastActive = idx;

  wheel.querySelector(`.sector[data-i="${idx}"]`)
    ?.classList.add("active");
  wheel.querySelector(`.textLabel[data-i="${idx}"]`)
    ?.classList.add("active");

  const row = data[currentRegion][idx];
  const [month, products, income] = row;

banner.textContent = `${month} ‚Äî Pay Rs ${income}`;
banner.style.background =
    currentRegion === "Terai" ? "#5EB65F" :
    currentRegion === "Hills" ? "#ff8c00" :
    "#00ccff";

line2.textContent = `You bought: ${products}`;
addGroupedLog(
    "Farm",
    currentRegion,                // ‚Üê Terai / Hills / Himalayas
    `${month} ‚Äî Pay Rs ${income}`,
    "popup-farm"
);
playSFX("farmResult", 0.8);


}



// ================= CASINO GAME LOGIC (EXACT COPY) =================

const symbols = ["‚ù§Ô∏è","‚ô¶Ô∏è","‚ô£Ô∏è","‚ô¶Ô∏è","‚ô†Ô∏è","‚ô¶Ô∏è","‚ô¶Ô∏è","‚ô¶Ô∏è"];

const winMessages = [
    "üí∞ You win 1 lakh!",
    "üéâ Jackpot! You win 1.5 lakh!",
    "üíµ You win 50 thousand!",
    "ü§ë Cash bonus! You win 2 lakh!",
    "üí∏ You just stole the bank‚Äôs money! +75k",
    "üéâ Celebration time! You made 1 lakh!"
];

const loseMessages = [
    "üí∏ You lose 1 lakh‚Ä¶",
    "üò¢ You lose 50 thousand‚Ä¶",
    "üìâ Bad luck‚Ä¶ you lose 20k.",
    "üò≠ Wallet crying‚Ä¶ -50k",
    "üèö You lose one of your properties to the owner!",
    "üöî Police fine! -25k",
    "üçÇ Money flew away like autumn leaves‚Ä¶ -25k",
    "ü™¶ Please dont come back‚Ä¶ -30k"
];

function showCasinoPopup(message){
    casinoPopupMessage.textContent = message;
    casinoPopup.classList.add("show");
    casinoPopupBox.classList.add("show");
}

function closeCasinoPopup(){
    casinoPopup.classList.remove("show");
    casinoPopupBox.classList.remove("show");
}

function buildStrip(){ return [...symbols, ...symbols, ...symbols]; }

function loadReels(){
    [reel1, reel2, reel3].forEach(reel=>{
        reel.innerHTML = buildStrip().map(s=>`<div>${s}</div>`).join("");
    });
}


let casinoSpinning = false;

const spinSpeed = 40;
const stopDelay = [4000,4500,5000];
let intervals = [];

function startSpin(reel){
    let pos = 0;
    intervals.push(setInterval(()=>{
        pos -= 20;
        reel.style.transform = `translateY(${pos}px)`;
        if (Math.abs(pos) >= reel.scrollHeight / 3) pos = 0;
    }, spinSpeed));
}

function stopReel(index){
    clearInterval(intervals[index]);
    const reel = document.getElementById(`reel${index+1}`);
    const strip = buildStrip();
    const chosen = symbols[Math.floor(Math.random()*symbols.length)];
    const offset = -strip.indexOf(chosen) * 80;
    reel.style.transform = `translateY(${offset}px)`;
    reel.dataset.value = chosen;
    if(index === 2) checkWin();
}

function pullLever(){
playSFX("casinoLever", 1);

    if(casinoSpinning) return;
    casinoSpinning = true;


    document.querySelector(".lever-area").classList.add("pull");
    setTimeout(()=>document.querySelector(".lever-area").classList.remove("pull"),250);

    intervals=[];
    [reel1,reel2,reel3].forEach(r=>r.classList.remove("win-glow"));
    result.textContent="";

    startSpin(reel1);
    startSpin(reel2);
    startSpin(reel3);

    setTimeout(()=>stopReel(0),stopDelay[0]);
    setTimeout(()=>stopReel(1),stopDelay[1]);
    setTimeout(()=>stopReel(2),stopDelay[2]);
}

function checkWin(){
    casinoSpinning = false;

    const a=reel1.dataset.value;
    const b=reel2.dataset.value;
    const c=reel3.dataset.value;

    if(a===b && b===c){
    result.textContent="üéâ JACKPOT!!! üéâ";
    [reel1,reel2,reel3].forEach(r=>r.classList.add("win-glow"));

    setTimeout(()=>{
        playSFX("casinoWin", 1.0);

addGroupedLog(
    "Casino",
    "WIN",
    ""
);

showCasinoPopup(


            winMessages[Math.floor(Math.random()*winMessages.length)]
        );
    }, 500); 
  // ‚è± 1 second delay

} else {

    setTimeout(()=>{
playSFX("casinoLose", 0.9);
addGroupedLog(
    "Casino",
    "LOSE",
    ""
);

        showCasinoPopup(
            loseMessages[Math.floor(Math.random()*loseMessages.length)]
        );
    }, 500);   // ‚è± 1 second delay
}

}




// ================= SHOPPING MALL DATA =================

const monthsBS = ["Baisakh","Jestha","Ashadh","Shrawan","Bhadra",
                  "Ashwin","Kartik","Mangsir","Poush","Magh","Falgun","Chaitra"];

const monthDaysBS = {
  "Baisakh":31,"Jestha":31,"Ashadh":32,"Shrawan":32,"Bhadra":31,
  "Ashwin":30,"Kartik":30,"Mangsir":30,"Poush":29,"Magh":29,"Falgun":30,"Chaitra":30
};

const incomeStars = {
  "Baisakh":"‚òÖ‚òÖ‚òÖ","Jestha":"‚òÖ‚òÖ","Ashadh":"‚òÖ‚òÖ","Shrawan":"‚òÖ‚òÖ‚òÖ","Bhadra":"‚òÖ‚òÖ‚òÖ",
  "Ashwin":"‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ","Kartik":"‚òÖ‚òÖ‚òÖ‚òÖ","Mangsir":"‚òÖ‚òÖ‚òÖ‚òÖ","Poush":"‚òÖ‚òÖ‚òÖ",
  "Magh":"‚òÖ‚òÖ","Falgun":"‚òÖ‚òÖ","Chaitra":"‚òÖ‚òÖ‚òÖ"
};

const festivalDescriptions = {
  "Baisakh":"Nepali New Year and start of new academic sessions increase shopping for school uniforms, bags, shoes, stationery, books, clothes, and household items.",
  "Jestha":
    "Extreme heat and regular school schedules reduce mall visits. Shopping is mostly limited to essentials and minor stationery replacements.",

  "Ashadh":
    "Monsoon season disrupts travel and leisure shopping. Families focus on farming, fees, and necessities, with limited spending on school supplies and rain-related items.",

  "Shrawan":
    "Religious activities and Teej preparations raise demand for clothes, jewelry, cosmetics, and school-related items as schools remain fully active.",

  "Bhadra":
    "Mid-academic demand for notebooks, exam materials, and accessories increases alongside early festival shopping preparations.",

  "Ashwin":
    "Dashain festival ! Heavy spending on clothes, electronics, footwear, gifts, and home upgrades.",

  "Kartik":
    "Tihar festival and extended school vacations sustain high demand for festive clothing, electronics, decorations, and student entertainment items.",

  "Mangsir":
    "Peak wedding season combined with college sessions and student relocations increases spending on clothing, jewelry, furniture, electronics, and education accessories.",

  "Poush":
    "Winter vacations and exams drive shopping for warm clothing, shoes, heaters, books, and study materials, with higher evening footfall.",

  "Magh":
    "Post-festival economic slowdown and normal school routines limit spending to essentials, food items, and basic stationery.",

  "Falgun":
    "Holi creates short bursts of spending on colors, clothes, and gifts, but overall mall activity remains modest due to academic focus.",

  "Chaitra":
    "Year-end clearance sales, exam completion, and preparation for the new academic year increase demand for bags, shoes, stationery, and household items."
};


const holidayMap = {
  "Baisakh 1":"Nepali New Year","Baisakh 18":"Republic Day","Baisakh 29":"Buddha Jayanti",
  "Jestha 15":"National Day",
  "Bhadra 10":"Teej",
  "Ashwin 3":"Constitution Day","Ashwin 6":"Ghatasthapana","Ashwin 13":"Fulpati",
  "Ashwin 14":"Ashtami","Ashwin 15":"Navami","Ashwin 16":"Dashami",
  "Ashwin 17":"Ekadashi",
  "Kartik 3":"Kag Tihar","Kartik 4":"Kukur Tihar","Kartik 5":"Laxmi Puja",
  "Kartik 6":"Govardhan Puja","Kartik 7":"Bhai Tika","Kartik 10":"Chhath",
  "Mangsir 18":"Udhauli","Poush 10":"Tamu Lhosar","Poush 15":"Yomari Punhi","Poush 27":"Prithvi Jayanti",
  "Magh 1":"Maghe Sankranti","Magh 5":"Sonam Lhosar","Magh 16":"Martyr's Day",
  "Falgun 3":"Shivaratri","Falgun 6":"Gyalpo Lhosar","Falgun 18":"Holi",
  "Chaitra 4":"Godhe Jatra","Chaitra 13":"Ram Nawami"
};


// ================= SHOPPING MALL FUNCTIONS =================

function renderMonth(month) {
  const days = monthDaysBS[month];

  let html = `<div class='month-title'>${month} 2082</div>`;
  html += "<div class='days-grid'>";

  ["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(d => {
    const cls = d==="Sa" ? "day-name saturday-header" : "day-name";
    html += `<div class='${cls}'>${d}</div>`;
  });

  let holidayList = [];

  for (let d=1; d<=days; d++) {
    let classes = [];
    if (d % 7 === 0) classes.push("saturday");

    const key = `${month} ${d}`;
    if (holidayMap[key]) {
      classes.push("holiday");
      holidayList.push(
        `<div class='holiday-item'>${key}: ${holidayMap[key]}</div>`
      );
    }

    html += `<div class='day ${classes.join(" ")}'>${d}</div>`;
  }

  html += "</div>";

  document.getElementById("page").innerHTML = html;
  document.getElementById("incomeBanner").textContent =
    `Expenses ${incomeStars[month]}`;

  document.getElementById("infoBox").innerHTML =
    `${festivalDescriptions[month]}<br><br>` +
    (holidayList.length
      ? `<b class='holiday-title'>Public Holidays:</b><br>${holidayList.join("")}`
      : "No public holidays this month.");
}


function startFlip() {
  let flipTime = 500 + Math.random()*3000;
  let interval = 120;
  let elapsed = 0;

  const flipInterval = setInterval(() => {


    const p = document.getElementById("page");
    p.classList.remove("flip");
    void p.offsetWidth;
    p.classList.add("flip");

    renderMonth(monthsBS[Math.floor(Math.random()*12)]);

    elapsed += interval;
    if (elapsed >= flipTime) {
      clearInterval(flipInterval);
if (SFX.mallFlip) {
    SFX.mallFlip.pause();
    SFX.mallFlip.currentTime = 0;
}


      const finalMonth = monthsBS[Math.floor(Math.random()*12)];

      setTimeout(() => {
        renderMonth(finalMonth);
// highlight expense banner
const incomeBanner = document.getElementById("incomeBanner");
if (incomeBanner) {
    incomeBanner.classList.remove("pulse");
    void incomeBanner.offsetWidth;   // force reflow
    incomeBanner.classList.add("pulse");
}

addGroupedLog(
    "Shopping Mall",
    `${finalMonth} (${incomeStars[finalMonth]})`,
    ""
);

playSFX("mallResult", 0.7);

        p.classList.remove("flip");
        p.style.transform="rotateX(0deg)";
      }, 200);
    }
  }, interval);
}




// CASINO




function emitFerrySmoke(wrapper) {
    const c = wrapper.querySelector(".ferry-smoke-container");
    const p = document.createElement("div");
    p.className = "ferry-smoke";
    c.appendChild(p);
    setTimeout(() => p.remove(), 2000);
}

function emitCarSmoke(wrapper) {
    const c = wrapper.querySelector(".car-smoke-container");
    const p = document.createElement("div");
    p.className = "car-smoke";
    c.appendChild(p);
    setTimeout(() => p.remove(), 2400);
}

function emitScooterSmoke(wrapper) {
    const c = wrapper.querySelector(".scooter-smoke-container");
    const p = document.createElement("div");
    p.className = "scooter-smoke";
    c.appendChild(p);
    setTimeout(() => p.remove(), 1400);
}

function emitTankSmoke(wrapper) {
    const c = wrapper.querySelector(".tank-smoke-container");
    const p = document.createElement("div");
    p.className = "tank-smoke";
    c.appendChild(p);
    setTimeout(() => p.remove(), 3000);
}

/* ======================================================
   VEHICLE SEQUENCE ENGINE
===================================================== */



const vehicleData = new Map([
    ["car",          { anim: "carCycle 25s linear forwards", dur: 25000 }],
    ["scooter",      { anim: "scooterCycle 11s linear forwards", dur: 11000 }],
    ["tank",         { anim: "tankCycle 40s linear forwards", dur: 40000 }],
    ["ferry",        { anim: "ferryCycle 30s linear forwards, ferryBob 30s ease-in-out infinite", dur: 30000 }],
["boomerang-hat", { anim: "boomerangHat 6s linear forwards", dur: 6000 }]
]);


const VEHICLE_VOLUME_MAP = {
    "car": 0.2,
    "scooter": 0.2,
    "tank": 0.1,
    "ferry": 0.15,
    "boomerang-hat": 0.2
};




function playVehicle(v) {
    if (!v) return;

    const type = v.dataset.vehicle;
    const data = vehicleData.get(type);

    /* reset */
    v.style.opacity = 1;
    v.style.left = "-40vh";
    v.style.animation = "none";
    void v.offsetWidth;
    v.style.animation = data.anim;

    /* CREATE SOUND OBJECT (THIS WAS MISSING) */
    let s = new Audio(v.dataset.sound);
    s.loop = true;
    v._sound = s;  // store reference so we can pause/resume

    /* VEHICLE VOLUME */
    const vol = VEHICLE_VOLUME_MAP[type] ?? 0.3;

    /* play if radio is not active */
    if (!radioMode) {
        s.play().then(() => {
            s.volume = vol;
        }).catch(()=>{});
    }

    /* smoke intervals */
    if (type === "car")     v._smoke = setInterval(() => emitCarSmoke(v), 350);
    if (type === "scooter") v._smoke = setInterval(() => emitScooterSmoke(v), 200);
    if (type === "tank")    v._smoke = setInterval(() => emitTankSmoke(v), 300);
    if (type === "ferry")   v._smoke = setInterval(() => emitFerrySmoke(v), 350);

    /* end after animation duration */
    setTimeout(() => {
        v.style.opacity = 0;
        v.style.animation = "none";

        if (v._smoke) {
            clearInterval(v._smoke);
            v._smoke = null;
        }

        s.pause();
        s.currentTime = 0;

        const nextDelay = Math.random() * 20000;
        setTimeout(() => startRandomVehicle(), nextDelay);

    }, data.dur);
}



function playWater(){
    // Show water and start rising animation
    waterStage.style.opacity = 1;
    waterStage.style.animation = "none";
    void waterStage.offsetWidth;
    waterStage.style.animation = "waterLevel 6s ease-in-out forwards";

    // After rise, do NOT hide water yet ‚Äî keep it visible during ferry
    setTimeout(()=>{
        const ferry = document.querySelector("#transportStage .ferry-wrapper");
        playVehicleWithWater(ferry);
    }, 5000);  // water rise duration
}




function playVehicleWithWater(v) {
    if (!v) return;

    const type = v.dataset.vehicle;
    const data = vehicleData.get(type);

    /* reset */
    v.style.opacity = 1;
    v.style.left = "-40vh";
    v.style.animation = "none";
    void v.offsetWidth;
    v.style.animation = data.anim;

    /* SOUND FIX */
    let s = new Audio(v.dataset.sound);
    s.loop = true;
    v._sound = s;

    const vol = VEHICLE_VOLUME_MAP[type] ?? 0.3;

    if (!radioMode) {
        s.play().then(() => {
            s.volume = vol;
        }).catch(()=>{});
    }

    /* smoke */
    if (type === "ferry") {
        v._smoke = setInterval(() => emitFerrySmoke(v), 350);
    }

    /* after animation ends */
    setTimeout(() => {
        v.style.opacity = 0;
        v.style.animation = "none";

        if (v._smoke) {
            clearInterval(v._smoke);
        }

        s.pause();
        s.currentTime = 0;

        /* drop water */
        waterStage.style.animation = "none";
        void waterStage.offsetWidth;
        waterStage.style.animation = "waterLevelDown 4s ease forwards";

        setTimeout(() => {
            waterStage.style.opacity = 0;
            const nextDelay = Math.random() * 20000;
            setTimeout(() => startRandomVehicle(), nextDelay);
        }, 4000);

    }, data.dur);
}







/* ============================================================
   RANDOM VEHICLE STARTER
============================================================ */

const waterStage = document.querySelector("#waterStage");

const vehicles = [
    document.querySelector("#transportStage .car"),
    document.querySelector("#transportStage .scooter"),
    document.querySelector("#transportStage .tank"),
    document.querySelector("#transportStage .boomerang-hat")  
];


/* ======================================================
   BOOMERANG HAT ANIMATION (UNTOUCHED LOGIC)
====================================================== */
(function(){
    let frames = "@keyframes boomerangHat {\n";

    function lerp(a,b,t){ return a+(b-a)*t; }

    for (let i=0; i<=100; i++) {
        let p = i/100;
        let x;

        if (p <= 0.33) x = lerp(0, 1300, p / 0.33);
        else if (p <= 0.66) x = lerp(1300, -1200, (p - 0.33) / 0.33);
        else x = lerp(-1200, 0, (p - 0.66) / 0.34);

        let y = Math.sin(p * Math.PI) * 35;

        frames += `${i}% { transform: translate(${x}px, ${y}px); }\n`;
    }

    frames += "}";

    let style = document.createElement("style");
    style.textContent = frames;
    document.head.appendChild(style);
})();




function startRandomVehicle(){
    let pick = Math.floor(Math.random() * (vehicles.length + 1));

    // Disable ferry temporarily
    if(pick === vehicles.length){
         playWater();
     } else {
         playVehicle(vehicles[pick]);
     }

}




/* ============================================================
   USER CLICK ACTIVATOR (REQUIRED FOR SOUND)
============================================================ */

document.addEventListener("click", function startOnce() {

    audioUnlocked = true;

    // Unlock audio by playing a silent dummy sound
    const unlock = new Audio();
    unlock.volume = 0;
    unlock.play().catch(()=>{});

    startRandomVehicle();
    document.removeEventListener("click", startOnce);
});

document.addEventListener("click", (e) => {
    if (e.target.closest("button")) {
        playSFX("draw", 0.5);
    }
});



</script>


<script>
/* =====================================================
      PARROT BEHAVIOR ‚Äî CLEAN, FIXED, FULL VERSION
===================================================== */

const parrot = document.getElementById("parrot");
const head = document.getElementById("head");
let isEscaping = false;
let dangerActive = false;

let lastSafeX = null;
let lastSafeY = null;

// ESCAPE HEIGHTS
const ESCAPE_HEIGHT = 150;
const SCOOTER_ESCAPE_HEIGHT = 260;

// WING SPEEDS
const NORMAL_WING_SPEED = "0.35s";
const FAST_WING_SPEED = "0.20s";
const SCOOTER_FAST_FLAP = "0.12s";

// SCOOTER PRIORITY FLAG
let scooterThreat = false;

// YOUR MANUAL PERCH POINTS
const perchPoints = [
    
{ x: 80, y: 4 },
{ x: 920, y: 15 },
{ x: 1340, y: 200 },
{ x: 1400, y: -20 },
{ x: 1400, y: 800 },
{ x: 730, y: 260 },
{ x: 700, y: 540 },
{ x: 800, y: 540 },
{ x: 1050, y: 700 },
    

];


/* Smooth flight */
function smoothFlyTo(targetX, targetY) {
    const rect = parrot.getBoundingClientRect();
// play short flight sound each time it moves
stopSound(parrotFlySound);
parrotFlySound = playParrotSound(parrotAudio.fly);

    const dx = targetX - rect.x;
    const dy = targetY - rect.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const speed = distance * 0.006;

    parrot.style.transition = `left ${speed}s ease, top ${speed}s ease`;
    parrot.style.left = `${targetX}px`;
    parrot.style.top = `${targetY}px`;

    head.style.transform = `rotate(${dx > 0 ? 10 : -10}deg)`;
}

(function placeParrotAtStart() {
    const start = perchPoints[Math.floor(Math.random() * perchPoints.length)];
    parrot.style.left = start.x + "px";
    parrot.style.top = start.y + "px";
})();
    

/* Normal movement loop */
function flyLoop() {
    if (isEscaping || dangerActive) return;

    const p = perchPoints[Math.floor(Math.random() * perchPoints.length)];
    smoothFlyTo(p.x, p.y);

    const wait = 20000+ Math.random() * 20000;
    setTimeout(flyLoop, wait);
}

setTimeout(flyLoop, 1500);

// PARROT IDLE CHIRPS (only when calm)
function startIdleChirps() {
    setInterval(() => {
        if (!dangerActive && !isEscaping) {
            const pick = parrotAudio.idle[Math.floor(Math.random()*parrotAudio.idle.length)];
            stopSound(parrotIdleSound);
            parrotIdleSound = playParrotSound(pick);
        }
    }, 30000+ Math.random()*30000);
}
startIdleChirps();



/* =====================================================
      DANGER DETECTION
===================================================== */
function checkVehicleDanger() {
    const vehicles = document.querySelectorAll(".vehicle");
    const pr = parrot.getBoundingClientRect();

    let foundDanger = false;
    scooterThreat = false;   // this now means "HIGH danger mode"

    vehicles.forEach(v => {
        const vr = v.getBoundingClientRect();

        const dx = Math.abs((vr.x + vr.width/2) - (pr.x + pr.width/2));
        const dy = Math.abs((vr.y + vr.height/2) - (pr.y + pr.height/2));
        const dist = Math.sqrt(dx*dx + dy*dy);

        // --- ALL VEHICLES WARNING ZONE (same as scooter logic before) ---
        if (dist < 500) {
            foundDanger = true;
            scooterThreat = true;   // <-- HIGH ESCAPE mode for ALL vehicles
        }
    });

    if (foundDanger && !isEscaping) {
        dangerActive = true;
        escapeFromDanger();
    }

    if (!foundDanger && dangerActive) {
        // stop escape sound early
        stopSound(parrotEscapeSound);
        parrotEscapeSound = null;

        dangerActive = false;
        returnToSafeSpot();
    }

    requestAnimationFrame(checkVehicleDanger);
}




/* =====================================================
      ESCAPE + HOVER
===================================================== */
function escapeFromDanger() {
    isEscaping = true;
// play danger alert once
stopSound(parrotDangerSound);
parrotDangerSound = playParrotSound(parrotAudio.danger);

// play continuous escape flapping
stopSound(parrotEscapeSound);
parrotEscapeSound = playParrotSound(parrotAudio.escape, true);


    const rect = parrot.getBoundingClientRect();
    lastSafeX = rect.x;
    lastSafeY = rect.y;

    // Select height and wing speed
    const height = scooterThreat ? SCOOTER_ESCAPE_HEIGHT : ESCAPE_HEIGHT;
    const wingSpeed = scooterThreat ? SCOOTER_FAST_FLAP : FAST_WING_SPEED;

    document.querySelectorAll(".wing")
        .forEach(w => w.style.animationDuration = wingSpeed);

    const escapeX = rect.x;
    const escapeY = Math.max(20, rect.y - height);

    parrot.style.transition = `left 0.5s ease, top 0.5s ease`;
    parrot.style.left = `${escapeX}px`;
    parrot.style.top = `${escapeY}px`;

    parrot.style.animation = "hoverShake 0.25s infinite";
    head.style.transform = scooterThreat ? "rotate(-25deg)" : "rotate(-10deg)";
}


/* =====================================================
      RETURN TO ORIGINAL SPOT
===================================================== */
function returnToSafeSpot() {
// stop escape flap when danger ends
stopSound(parrotEscapeSound);
parrotEscapeSound = null;

    if (!lastSafeX || !lastSafeY) return;

    document.querySelectorAll(".wing")
        .forEach(w => w.style.animationDuration = NORMAL_WING_SPEED);

    parrot.style.animation = "bobbing 3.5s infinite ease-in-out";

    parrot.style.transition = `left 1.4s ease, top 1.4s ease`;
    parrot.style.left = `${lastSafeX}px`;
    parrot.style.top = `${lastSafeY}px`;

    head.style.transform = "rotate(0deg)";

    setTimeout(() => {
        isEscaping = false;
        flyLoop();
    }, 1500);
}

checkVehicleDanger();

</script>


<div id="parkScreen" style="
    position:fixed;
    inset:0;
    background: radial-gradient(circle at top, #58b368, #0b1020 70%);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:200000;
">
    <div id="parkContent"></div>

    <div
        style="
            position:absolute;
            top:2vh;
            right:3vh;
            font-size:5vh;
            cursor:pointer;
            color:white;
        "
        onclick="closeParkScreen()"
    >
        ‚úñ
    </div>
</div>

<div id="mallScreen" style="
    position:fixed;
    inset:0;
    background: radial-gradient(circle at top, #1e3c72, #0b1020 70%);

    display:none;
    align-items:center;
    justify-content:center;
    z-index:200000;
">
    <div id="mallContent"></div>

    <div
    style="
        position:absolute;
        top:2vh;
        right:3vh;
        font-size:5vh;
        cursor:pointer;
        color:white;          /* ‚Üê makes close white */
    "
    onclick="closeShoppingMall()"
>
    ‚úñ
</div>

</div>


<div id="farmScreen" style="
    position:fixed;
    inset:0;
    background: var(--scene-dark);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:200000;
">
    <div id="farmContent"></div>

    <div
        style="
            position:absolute;
            top:2vh;
            right:3vh;
            font-size:5vh;
            cursor:pointer;
            color:white;
        "
        onclick="closeFarm()"
    >
        ‚úñ
    </div>
</div>


<div id="casinoScreen" style="
    position:fixed;
    inset:0;
    background: radial-gradient(circle at top, #6a0dad, #0b1020 70%);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:200000;
">
    <div id="casinoContent"></div>

    <div
        style="
            position:absolute;
            top:2vh;
            right:3vh;
            font-size:5vh;
            cursor:pointer;
            color:white;
        "
        onclick="closeCasino()"
    >
        ‚úñ
    </div>
</div>

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/Nepali_Monopoly/sw.js");
  });
}
</script>

</body>
</html>




